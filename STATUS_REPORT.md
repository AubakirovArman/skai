# üìä –ò—Ç–æ–≥–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–∏ AlemLLM + PostgreSQL

**–î–∞—Ç–∞:** 5 –æ–∫—Ç—è–±—Ä—è 2025 –≥.

---

## ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. –í–µ–∫—Ç–æ—Ä–Ω—ã–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- **–í–ù–î (–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã)**
  - ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã
  - ‚úÖ –≠–º–±–µ–¥–¥–∏–Ω–≥–∏ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω—ã (BAAI/bge-m3, dimension 1024)
  - ‚úÖ –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç
  - ‚úÖ –ü—Ä–∏–º–µ—Ä—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:
    - "–ü–æ–ª–æ–∂–µ–Ω–∏–µ –æ –°–î –ø–æ —Å–æ—Å—Ç 10.12.2024–≥."
    - "–ü–æ–ª–æ–∂–µ–Ω–∏–µ_–æ_–ö–ù–í_–°–î_–ø–æ_—Å–æ—Å—Ç_21_04_2023–≥_"
    - –î—Ä—É–≥–∏–µ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Ä–µ–≥–ª–∞–º–µ–Ω—Ç—ã

- **–ù–ü–ê (–ù–æ—Ä–º–∞—Ç–∏–≤–Ω–æ-–ø—Ä–∞–≤–æ–≤—ã–µ –∞–∫—Ç—ã –†–ö)**
  - ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã
  - ‚úÖ –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç (BM25 + Dense + Sparse vectors)
  - ‚úÖ –ü—Ä–∏–º–µ—Ä—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤:
    - –ó–∞–∫–æ–Ω "–û–± –∞–∫—Ü–∏–æ–Ω–µ—Ä–Ω—ã—Ö –æ–±—â–µ—Å—Ç–≤–∞—Ö"
    - –î—Ä—É–≥–æ–µ –∑–∞–∫–æ–Ω–æ–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞

### 2. Embedding Service
```json
{
  "status": "healthy",
  "model": "BAAI/bge-m3",
  "device": "mps",
  "dimension": 1024
}
```
- ‚úÖ –ó–∞–ø—É—â–µ–Ω –Ω–∞ localhost:8001
- ‚úÖ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è embeddings —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ Health check –ø—Ä–æ—Ö–æ–¥–∏—Ç

### 3. –ö–æ–¥ –º–∏–≥—Ä–∞—Ü–∏–∏
- ‚úÖ `src/lib/alemllm.ts` - AlemLLM –∫–ª–∏–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω
- ‚úÖ `src/lib/vector-db.ts` - PostgreSQL —É—Ç–∏–ª–∏—Ç—ã —Å–æ–∑–¥–∞–Ω—ã
- ‚úÖ `src/lib/embedding-service.py` - FastAPI —Å–µ—Ä–≤–∏—Å —Å–æ–∑–¥–∞–Ω
- ‚úÖ `src/lib/embedding-client.ts` - TypeScript –∫–ª–∏–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω
- ‚úÖ –í—Å–µ 5 API endpoints –æ–±–Ω–æ–≤–ª–µ–Ω—ã:
  - `/api/analyze/vnd/route.ts`
  - `/api/analyze/np/route.ts`
  - `/api/analyze/summary/route.ts`
  - `/api/vnd/route.ts`
  - `/api/np/route.ts`
- ‚úÖ OpenAI –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω –∏–∑ –ø—Ä–æ–µ–∫—Ç–∞

---

## ‚ö†Ô∏è –¢–µ–∫—É—â–∏–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. AlemLLM API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É 400
**–°–∏–º–ø—Ç–æ–º—ã:**
```json
{
  "error": "–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ AlemLLM API"
}
```

**–î–µ—Ç–∞–ª–∏ –æ—à–∏–±–∫–∏:**
```
Status Code: 400
{
  "object": "error",
  "message": "JSON decode error: Unterminated string starting at...",
  "type": "BadRequestError",
  "code": 400
}
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
1. –ü—Ä–æ–±–ª–µ–º–∞ —Å –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π –∫–∏—Ä–∏–ª–ª–∏—Ü—ã –≤ JSON
2. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–æ–≤
3. –°–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç (–ø—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤)
4. –ü—Ä–æ–±–ª–µ–º–∞ —Å —Ñ–æ—Ä–º–∞—Ç–æ–º —Å–æ–æ–±—â–µ–Ω–∏–π

**–¢—Ä–µ–±—É–µ—Ç—Å—è:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞ –∫ AlemLLM API
- –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å –∫–æ—Ä–æ—Ç–∫–∏–º –∞–Ω–≥–ª–∏–π—Å–∫–∏–º —Ç–µ–∫—Å—Ç–æ–º
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é AlemLLM API –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π

---

## üîç –î–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–æ —Ä–∞–±–æ—Ç—ã –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞

### Python demo (demo_search.py) - ‚úÖ –†–ê–ë–û–¢–ê–ï–¢

**–¢–µ—Å—Ç –í–ù–î:**
```
üîé –ó–∞–ø—Ä–æ—Å: "–ø–æ–ª–Ω–æ–º–æ—á–∏—è —Å–æ–≤–µ—Ç–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–æ–≤"
‚úÖ –ù–∞–π–¥–µ–Ω–æ: 5 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
–†–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å: 45.11% - 38.89%
```

**–¢–µ—Å—Ç –ù–ü–ê:**
```
üîé –ó–∞–ø—Ä–æ—Å: "–∫–∞–∫ –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ä–µ—à–µ–Ω–∏—è —Å–æ–≤–µ—Ç–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–æ–≤"
‚úÖ –ù–∞–π–¥–µ–Ω–æ: 5 —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
–ò–∑ –ó–∞–∫–æ–Ω–∞ "–û–± –∞–∫—Ü–∏–æ–Ω–µ—Ä–Ω—ã—Ö –æ–±—â–µ—Å—Ç–≤–∞—Ö", –°—Ç–∞—Ç—å—è 58
```

### TypeScript API - ‚ö†Ô∏è –ß–ê–°–¢–ò–ß–ù–û –†–ê–ë–û–¢–ê–ï–¢
- ‚úÖ Embedding –≥–µ–Ω–µ—Ä–∞—Ü–∏—è: —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ Vector search: —Ä–∞–±–æ—Ç–∞–µ—Ç (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã)
- ‚úÖ –ö–æ–Ω—Ç–µ–∫—Å—Ç —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è: —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚ùå AlemLLM API: –æ—à–∏–±–∫–∞ 400

---

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1: –ò—Å–ø—Ä–∞–≤–∏—Ç—å AlemLLM API –æ—à–∏–±–∫—É
1. –î–æ–±–∞–≤–∏—Ç—å –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤:
   ```typescript
   console.log('AlemLLM Request:', JSON.stringify(requestBody, null, 2))
   ```

2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å –ø—Ä–æ—Å—Ç—ã–º –∑–∞–ø—Ä–æ—Å–æ–º:
   ```typescript
   const result = await alemllm.complete(
     'Hello',  // –ö–æ—Ä–æ—Ç–∫–∏–π –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —Ç–µ–∫—Å—Ç
     'You are a helpful assistant.',
     { max_tokens: 50 }
   )
   ```

3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–∏–º–∏—Ç—ã:
   - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
   - –§–æ—Ä–º–∞—Ç JSON
   - –ö–æ–¥–∏—Ä–æ–≤–∫–∞ UTF-8

4. –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –ø–æ–¥—Ö–æ–¥:
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ –∫–æ—Ä–æ—Ç–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
   - –°–∂–∏–º–∞—Ç—å/—Å—É–º–º–∞—Ä–∏–∑–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–π–¥–µ–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
   - –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å –ø–æ —á–∞—Å—Ç—è–º

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2: –£–ª—É—á—à–∏—Ç—å –ø—Ä–æ–º–ø—Ç—ã
- –°–¥–µ–ª–∞—Ç—å system prompts –∫–æ—Ä–æ—á–µ
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å user prompts
- –î–æ–±–∞–≤–∏—Ç—å fallback –ª–æ–≥–∏–∫—É

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3: –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞
- –°—á–∏—Ç–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- –û—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Ä–∞–∑–º–µ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞

---

## üõ†Ô∏è –û—Ç–ª–∞–¥–æ—á–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö (Python)
```bash
python3 demo_search.py
# –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º:
# vnd <–∑–∞–ø—Ä–æ—Å>
# npa <–∑–∞–ø—Ä–æ—Å>
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ Embedding Service
```bash
curl http://localhost:8001/health
```

### –¢–µ—Å—Ç –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ (Node.js)
```bash
node test-vector-search.js
```

### –¢–µ—Å—Ç AlemLLM API
```bash
node test-alemllm-direct.js
```

### –¢–µ—Å—Ç –ø–æ–ª–Ω–æ–≥–æ pipeline
```bash
./test-api.sh
```

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–∏

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –î–µ—Ç–∞–ª–∏ |
|-----------|--------|--------|
| –í–ù–î –ë–∞–∑–∞ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | –î–æ–∫—É–º–µ–Ω—Ç—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã, –ø–æ–∏—Å–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç |
| –ù–ü–ê –ë–∞–∑–∞ | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∏—Ä—É–µ—Ç |
| Embedding Service | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | BAAI/bge-m3 –Ω–∞ MPS |
| Vector Search | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç | –ù–∞—Ö–æ–¥–∏—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã |
| AlemLLM API | ‚ùå –û—à–∏–±–∫–∞ 400 | –¢—Ä–µ–±—É–µ—Ç—Å—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ |
| OpenAI | ‚úÖ –£–¥–∞–ª–µ–Ω | 22 –ø–∞–∫–µ—Ç–∞ —É–¥–∞–ª–µ–Ω—ã |

---

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è:** –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥—É—é –º–æ–¥–µ–ª—å alemllm –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–∫—Ç—É–∞–ª—å–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é API

2. **–í—Ä–µ–º–µ–Ω–Ω—ã–π workaround:** –ú–æ–∂–Ω–æ –≤—Ä–µ–º–µ–Ω–Ω–æ –≤–µ—Ä–Ω—É—Ç—å fallback –Ω–∞ general knowledge –µ—Å–ª–∏ AlemLLM –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

3. **–î–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ:** 
   - –°–≤—è–∑–∞—Ç—å—Å—è —Å –∫–æ–º–∞–Ω–¥–æ–π alemllm –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ API
   - –î–æ–±–∞–≤–∏—Ç—å retry logic —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤

---

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã

- **AlemLLM API:** <YOUR_ALEMLLM_API_URL>
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** –¢—Ä–µ–±—É–µ—Ç—Å—è –∑–∞–ø—Ä–æ—Å–∏—Ç—å —É –∫–æ–º–∞–Ω–¥—ã alemllm
- **PostgreSQL:** <YOUR_DB_HOST>:5433

---

*–û–±–Ω–æ–≤–ª–µ–Ω–æ: 5 –æ–∫—Ç—è–±—Ä—è 2025 –≥., 15:00 UTC+6*
