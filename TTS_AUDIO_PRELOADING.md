# TTS Audio Preloading - Complete Implementation

## –ó–∞–¥–∞—á–∞

–ì–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∞—É–¥–∏–æ –¥–ª—è –≤—Å–µ—Ö —Ç—Ä—ë—Ö –≤–∫–ª–∞–¥–æ–∫ (VND, Legal, Summary) **–≤–æ –≤—Ä–µ–º—è –∞–Ω–∞–ª–∏–∑–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞**, —á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–≥ —Å—Ä–∞–∑—É —Å–ª—É—à–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –±–µ–∑ –æ–∂–∏–¥–∞–Ω–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏.

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

**–î–æ (–±–µ–∑ –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∏):**
1. –ê–Ω–∞–ª–∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞: 90-120 —Å–µ–∫—É–Ω–¥
2. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
3. –ù–∞–∂–∏–º–∞–µ—Ç "üîä –û–∑–≤—É—á–∏—Ç—å"
4. **–ñ–¥—ë—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∞—É–¥–∏–æ: 30-40 —Å–µ–∫—É–Ω–¥** ‚è≥
5. –°–ª—É—à–∞–µ—Ç

**–ü–æ—Å–ª–µ (—Å –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–æ–π):**
1. –ê–Ω–∞–ª–∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞: 90-120 —Å–µ–∫—É–Ω–¥
2. **–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è 3 –∞—É–¥–∏–æ: 30-40 —Å–µ–∫—É–Ω–¥** (—Ñ–æ–Ω–æ–º)
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
4. –ù–∞–∂–∏–º–∞–µ—Ç "üîä –û–∑–≤—É—á–∏—Ç—å"
5. **–ú–≥–Ω–æ–≤–µ–Ω–Ω–æ –Ω–∞—á–∏–Ω–∞–µ—Ç —Å–ª—É—à–∞—Ç—å!** ‚ö°

**–≠–∫–æ–Ω–æ–º–∏—è –≤—Ä–µ–º–µ–Ω–∏: 30-40 —Å–µ–∫—É–Ω–¥ –Ω–∞ –∫–∞–∂–¥–æ–π –≤–∫–ª–∞–¥–∫–µ!**

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### 1. –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `AnalysisResult`

```typescript
interface AnalysisResult {
  vnd: string
  np: string
  summary: string
  fileName?: string
  timestamp?: Date
  language?: 'ru' | 'kk' | 'en'
  audioUrls?: {
    vnd?: string      // –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–µ –∞—É–¥–∏–æ –¥–ª—è VND
    np?: string       // –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–µ –∞—É–¥–∏–æ –¥–ª—è Legal
    summary?: string  // –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–µ –∞—É–¥–∏–æ –¥–ª—è Summary
  }
}
```

### 2. Preloader (`src/lib/tts-preloader.ts`)

```typescript
export async function preloadTTSAudio(
  texts: { vnd: string, np: string, summary: string },
  lang: 'kk' | 'ru' | 'en',
  onProgress?: (progress: PreloadProgress) => void
): Promise<PreloadResult>
```

**–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:**
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç 3 –∞—É–¥–∏–æ **–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ** (Promise.all)
- –û—á–∏—â–∞–µ—Ç —Ç–µ–∫—Å—Ç—ã –æ—Ç Markdown –ø–µ—Ä–µ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç progress callbacks
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –≤–∫–ª–∞–¥–∫–∏ –æ—Ç–¥–µ–ª—å–Ω–æ
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç Blob URLs

**–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
```typescript
const audioUrls = await preloadTTSAudio(
  {
    vnd: vndResult,
    np: npResult,
    summary: summaryResult
  },
  'kk',
  (progress) => {
    console.log(`Progress: ${progress.current}/3 - ${progress.step}`)
  }
)

// Result:
// {
//   vnd: "blob:http://localhost:3001/abc123...",
//   np: "blob:http://localhost:3001/def456...",
//   summary: "blob:http://localhost:3001/ghi789..."
// }
```

### 3. useTTS Hook Extension

**–ù–æ–≤—ã–π –º–µ—Ç–æ–¥ `playFromUrl()`:**
```typescript
const tts = useTTS(...)

// –í–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ –∞—É–¥–∏–æ
tts.playFromUrl(audioUrl, text)

// –í–º–µ—Å—Ç–æ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–æ–≤–æ–≥–æ
tts.play(text) // –°—Ç–∞—Ä—ã–π —Å–ø–æ—Å–æ–±
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ (–Ω–µ—Ç –∑–∞–ø—Ä–æ—Å–∞ –∫ API)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ pause/resume/stop
- –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ª–æ–≥–∏–∫–æ–π

### 4. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –ø—Ä–æ—Ü–µ—Å—Å –∞–Ω–∞–ª–∏–∑–∞

```typescript
// –ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –≤—Å–µ—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∞–Ω–∞–ª–∏–∑–∞
setAnalysisStep('audio-preload')

const audioUrls = await preloadTTSAudio(
  { vnd: vndResult, np: npResult, summary: summaryResult },
  language,
  (progress) => setAudioPreloadProgress(progress)
)

const analysisWithMetadata = {
  ...results,
  audioUrls // ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ–º URL-—ã
}

setAnalysisResult(analysisWithMetadata)
setAnalysisStep('complete')
```

### 5. –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π UI Flow

**–ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä:**
- 0%: Upload
- 25%: VND Analysis
- 50%: Legal Analysis  
- 75%: Summary Generation
- **90%: üéµ Audio Preload** (NEW!)
- 100%: Complete

**–ù–æ–≤—ã–π —à–∞–≥ –≤ —Å–ø–∏—Å–∫–µ:**
```tsx
<StepRow
  title="üéµ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∞—É–¥–∏–æ"
  active={analysisStep === 'audio-preload'}
  done={analysisStep === 'complete'}
  idle={...}
/>
```

### 6. handleTTSClick Logic

```typescript
const handleTTSClick = () => {
  // –ü–æ–ª—É—á–∞–µ–º –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–µ –∞—É–¥–∏–æ –¥–ª—è —Ç–µ–∫—É—â–µ–π –≤–∫–ª–∞–¥–∫–∏
  const preloadedUrl = analysisResult?.audioUrls?.[activeTab]
  
  if (preloadedUrl) {
    console.log('üéµ Using preloaded audio')
    tts.playFromUrl(preloadedUrl, currentTabText) // ‚ö° –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ!
  } else {
    console.log('üé§ Generating new audio')
    tts.play(currentTabText) // Fallback –Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—é
  }
}
```

## –õ–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏

### –í–æ –≤—Ä–µ–º—è –∞–Ω–∞–ª–∏–∑–∞:

```
[VND] üéµ Starting audio preload...
[TTS Preloader] üé¨ Starting preload for 3 tabs
[TTS Preloader] üåê Language: kk
[TTS Preloader] üßπ Cleaned text lengths: {vnd: 4995, np: 4850, summary: 3210}
[TTS Preloader] üé§ Generating VND audio...
[TTS Preloader] üé§ Generating Legal audio...
[TTS Preloader] üé§ Generating Summary audio...

// 30-40 —Å–µ–∫—É–Ω–¥ —Å–ø—É—Å—Ç—è...

[TTS Preloader] ‚úÖ VND audio ready
[TTS Preloader] ‚úÖ Legal audio ready
[TTS Preloader] ‚úÖ Summary audio ready
[TTS Preloader] üéâ Preload complete: 3 / 3 successful
[VND] ‚úÖ Audio preload complete: {vnd: "blob:...", np: "blob:...", summary: "blob:..."}
```

### –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–Ω–æ–ø–∫–∏ TTS:

```
[VND] üéµ TTS Click: {
  isPlaying: false,
  isPaused: false,
  hasPreloadedUrl: true,  // ‚úÖ
  activeTab: 'vnd'
}
[VND] üéµ Using preloaded audio
[useTTS] üéµ Playing from preloaded URL
[useTTS] ‚ñ∂Ô∏è Preloaded audio playing  // ‚ö° –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ!
```

## –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –ï—Å–ª–∏ –æ–¥–Ω–∞ –∏–∑ –≥–µ–Ω–µ—Ä–∞—Ü–∏–π —É–ø–∞–ª–∞:

```typescript
const audioUrls = {
  vnd: "blob:...",
  np: undefined,        // ‚ùå –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
  summary: "blob:...",
  errors: {
    np: Error("Generation failed")
  }
}
```

**Fallback:** –ü—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ Legal –≤–∫–ª–∞–¥–∫–µ –±—É–¥–µ—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏:
```typescript
if (preloadedUrl) {
  tts.playFromUrl(preloadedUrl, text) // ‚úÖ –î–ª—è VND –∏ Summary
} else {
  tts.play(text) // üé§ Fallback –¥–ª—è Legal
}
```

## –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é

### Blob URLs

```typescript
// –°–æ–∑–¥–∞–Ω–∏–µ
audioUrl = URL.createObjectURL(blob)  // "blob:http://localhost:3001/..."

// –û—á–∏—Å—Ç–∫–∞ (–ø—Ä–∏ unmount –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞)
useEffect(() => {
  return () => {
    if (analysisResult?.audioUrls) {
      revokeAudioUrls(analysisResult.audioUrls)
    }
  }
}, [analysisResult])
```

### –†–∞–∑–º–µ—Ä –≤ –ø–∞–º—è—Ç–∏

- –ö–∞–∂–¥–æ–µ –∞—É–¥–∏–æ: ~2MB (MP3, 48kbps)
- 3 –≤–∫–ª–∞–¥–∫–∏: ~6MB
- –ö—ç—à useTTS: –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ
- **–ò—Ç–æ–≥–æ: ~10-15MB RAM**

## –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è

**Promise.all vs –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è:**

```typescript
// ‚ùå –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è (120 —Å–µ–∫—É–Ω–¥)
await generateVND()   // 40 —Å–µ–∫
await generateLegal() // 40 —Å–µ–∫
await generateSummary() // 40 —Å–µ–∫

// ‚úÖ –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è (40 —Å–µ–∫—É–Ω–¥)
await Promise.all([
  generateVND(),
  generateLegal(),
  generateSummary()
])
```

**–≠–∫–æ–Ω–æ–º–∏—è: 80 —Å–µ–∫—É–Ω–¥!**

### –û–±—â–µ–µ –≤—Ä–µ–º—è –∞–Ω–∞–ª–∏–∑–∞

| –≠—Ç–∞–ø | –ë–µ–∑ –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∏ | –° –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–æ–π |
|------|-----------------|----------------|
| –ê–Ω–∞–ª–∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞ | 90-120 —Å–µ–∫ | 90-120 —Å–µ–∫ |
| –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∞—É–¥–∏–æ | - | +30-40 —Å–µ–∫ (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ) |
| **–ò—Ç–æ–≥–æ –¥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤** | **90-120 —Å–µ–∫** | **120-160 —Å–µ–∫** |
| –ö–ª–∏–∫ "–û–∑–≤—É—á–∏—Ç—å" | +30-40 —Å–µ–∫ ‚è≥ | –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ! ‚ö° |
| **–ò—Ç–æ–≥–æ –¥–æ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏—è** | **120-160 —Å–µ–∫** | **120-160 —Å–µ–∫** |

**–í—ã–≤–æ–¥:** –û–±—â–µ–µ –≤—Ä–µ–º—è –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ, –Ω–æ UX –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –ª—É—á—à–µ!

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ UX

1. **üöÄ –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∂–¥—ë—Ç –ø–æ—Å–ª–µ –∫–ª–∏–∫–∞
   - –ö–Ω–æ–ø–∫–∞ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç —Å—Ä–∞–∑—É

2. **üîÑ –ë—ã—Å—Ç—Ä–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫**
   - –í–∫–ª–∞–¥–∫–∞ 1 ‚Üí –∏–≥—Ä–∞–µ—Ç —Å—Ä–∞–∑—É
   - –í–∫–ª–∞–¥–∫–∞ 2 ‚Üí –∏–≥—Ä–∞–µ—Ç —Å—Ä–∞–∑—É
   - –í–∫–ª–∞–¥–∫–∞ 3 ‚Üí –∏–≥—Ä–∞–µ—Ç —Å—Ä–∞–∑—É

3. **üíæ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç**
   - –í–æ–∑–≤—Ä–∞—Ç –Ω–∞ –≤–∫–ª–∞–¥–∫—É ‚Üí –∏–∑ –∫—ç—à–∞
   - –ù–∏–∫–∞–∫–∏—Ö –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –≥–µ–Ω–µ—Ä–∞—Ü–∏–π

4. **üìä –ü—Ä–æ–≥—Ä–µ—Å—Å –≤–∏–¥–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é**
   - "üéµ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∞—É–¥–∏–æ" –≤ —Å–ø–∏—Å–∫–µ —à–∞–≥–æ–≤
   - –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä 90%
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–Ω–∏–º–∞–µ—Ç, —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –£—Å–ø–µ—à–Ω–∞—è –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞

1. –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–Ω–∞–ª–∏–∑
3. –î–æ–∂–¥–∞—Ç—å—Å—è —à–∞–≥–∞ "üéµ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∞—É–¥–∏–æ" (90%)
4. –û—Ç–∫—Ä—ã—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (100%)
5. –ù–∞–∂–∞—Ç—å "üîä –û–∑–≤—É—á–∏—Ç—å" ‚Üí **–º–≥–Ω–æ–≤–µ–Ω–Ω–æ –∏–≥—Ä–∞–µ—Ç** ‚úÖ
6. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –≤–∫–ª–∞–¥–∫—É ‚Üí –Ω–∞–∂–∞—Ç—å "üîä –û–∑–≤—É—á–∏—Ç—å" ‚Üí **–º–≥–Ω–æ–≤–µ–Ω–Ω–æ –∏–≥—Ä–∞–µ—Ç** ‚úÖ

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

1. –û—Ç–∫–ª—é—á–∏—Ç—å TTS API (—Å–∏–º—É–ª—è—Ü–∏—è)
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –∞–Ω–∞–ª–∏–∑
3. –î–æ–∂–¥–∞—Ç—å—Å—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
4. –ù–∞–∂–∞—Ç—å "üîä –û–∑–≤—É—á–∏—Ç—å" ‚Üí **fallback –Ω–∞ live –≥–µ–Ω–µ—Ä–∞—Ü–∏—é** ‚úÖ

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

1. –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç 1 ‚Üí –ø—Ä–æ—Å–ª—É—à–∞—Ç—å
2. –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç 2 ‚Üí –ø—Ä–æ—Å–ª—É—à–∞—Ç—å
3. –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –¥–æ–∫—É–º–µ–Ω—Ç—É 1 (–∏–∑ localStorage) ‚Üí **–∞—É–¥–∏–æ –Ω–µ—Ç, –Ω—É–∂–Ω–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è** ‚ö†Ô∏è

**Note:** localStorage –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç Blob URLs, –ø–æ—ç—Ç–æ–º—É –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç.

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **–ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã**
   - Blob URLs –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ localStorage
   - Fallback –Ω–∞ live –≥–µ–Ω–µ—Ä–∞—Ü–∏—é

2. **–†–∞–∑–º–µ—Ä –ø–∞–º—è—Ç–∏**
   - ~10-15MB RAM
   - –ú–æ–∂–µ—Ç –±—ã—Ç—å –ø—Ä–æ–±–ª–µ–º–æ–π –Ω–∞ —Å—Ç–∞—Ä—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö

3. **–í—Ä–µ–º—è –æ–±—â–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è**
   - +30-40 —Å–µ–∫—É–Ω–¥
   - –ù–æ UX –ª—É—á—à–µ (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∂–¥—ë—Ç –ø–æ—Å–ª–µ –∫–ª–∏–∫–∞)

## –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### 1. IndexedDB Storage

```typescript
// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ Blob –≤ IndexedDB
await db.audioCache.put({
  key: `${documentHash}-${tab}`,
  blob: audioBlob,
  timestamp: Date.now()
})

// –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
const cached = await db.audioCache.get(`${documentHash}-vnd`)
if (cached && Date.now() - cached.timestamp < 3600000) { // 1 —á–∞—Å
  const url = URL.createObjectURL(cached.blob)
  tts.playFromUrl(url, text)
}
```

### 2. Progressive Preload

```typescript
// –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—É—é –≤–∫–ª–∞–¥–∫—É —Å—Ä–∞–∑—É
await preloadTTSAudio({ [activeTab]: result[activeTab] }, lang)

// –û—Å—Ç–∞–ª—å–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏ - –≤ —Ñ–æ–Ω–µ —Å –Ω–∏–∑–∫–∏–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–æ–º
setTimeout(() => {
  preloadTTSAudio({ 
    ...otherTabs 
  }, lang)
}, 2000)
```

### 3. Compression

```typescript
// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ –Ω–∏–∑–∫–∏–π bitrate
const audioUrl = await ttsClient.generateSpeechURL(text, lang, {
  bitrate: '32kbps' // –í–º–µ—Å—Ç–æ 48kbps
})

// –†–∞–∑–º–µ—Ä: ~1.3MB –≤–º–µ—Å—Ç–æ ~2MB
```

## –°—Ç–∞—Ç—É—Å

‚úÖ **–ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏ –≥–æ—Ç–æ–≤–æ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é**

### –§–∞–π–ª—ã:
- `src/lib/tts-preloader.ts` - Preloader —É—Ç–∏–ª–∏—Ç–∞
- `src/hooks/useTTS.ts` - –î–æ–±–∞–≤–ª–µ–Ω `playFromUrl()`
- `src/app/virtual-director/page.tsx` - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ –ø—Ä–æ—Ü–µ—Å—Å –∞–Ω–∞–ª–∏–∑–∞

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å:
1. –ê–Ω–∞–ª–∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞ ‚Üí —à–∞–≥ "üéµ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∞—É–¥–∏–æ" –ø–æ—è–≤–ª—è–µ—Ç—Å—è
2. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≥–æ—Ç–æ–≤—ã ‚Üí –Ω–∞–∂–∞—Ç—å "üîä –û–∑–≤—É—á–∏—Ç—å" ‚Üí –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –∏–≥—Ä–∞–µ—Ç
3. –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫ ‚Üí –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
4. –ö–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ ‚Üí –ª–æ–≥–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞—é—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ preloaded audio

---

**–î–∞—Ç–∞:** 6 –æ–∫—Ç—è–±—Ä—è 2025 –≥.
