# TTS Audio Caching Implementation

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ –∫–∞–∂–¥–æ–º –∫–ª–∏–∫–µ –Ω–∞ –∫–Ω–æ–ø–∫—É TTS (–¥–∞–∂–µ –ø—Ä–∏ –ø–∞—É–∑–µ/–ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–∏) –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–ª–æ—Å—å –Ω–æ–≤–æ–µ –∞—É–¥–∏–æ:

```
[TTS Proxy] üé§ Generating speech...
[TTS Proxy] üìù Text length: 4995
[TTS Proxy] üåê Language: kk
[TTS Proxy] ‚úÖ Speech generated, size: 2005632 bytes
POST /api/tts 200 in 32449ms  // 32 —Å–µ–∫—É–Ω–¥—ã!
```

**–ü—Ä–∏—á–∏–Ω—ã:**
1. –§—É–Ω–∫—Ü–∏—è `generateAndPlay()` –≤—ã–∑—ã–≤–∞–ª–∞—Å—å –∫–∞–∂–¥—ã–π —Ä–∞–∑ –∑–∞–Ω–æ–≤–æ
2. –ù–µ –±—ã–ª–æ –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ —Ç–µ–∫—Å—Ç —É–∂–µ –±—ã–ª –æ–∑–≤—É—á–µ–Ω
3. Blob URL —Å–æ–∑–¥–∞–≤–∞–ª—Å—è –∫–∞–∂–¥—ã–π —Ä–∞–∑, –¥–∞–∂–µ –¥–ª—è —Ç–æ–≥–æ –∂–µ —Ç–µ–∫—Å—Ç–∞

## –†–µ—à–µ–Ω–∏–µ: –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∞—É–¥–∏–æ

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∞—É–¥–∏–æ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ö–µ—à–∞ —Ç–µ–∫—Å—Ç–∞.

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```typescript
// –ö—ç—à —Å—Ç—Ä—É–∫—Ç—É—Ä–∞
audioCacheRef = Map<textHash, { url: string, lang: 'kk' | 'ru' }>

// textHash = `${lang}-${length}-${base64(first100+last100)}`
// –ü—Ä–∏–º–µ—Ä: "kk-4995-VGhpcyBpcyBhIG1lZXRpbmcgYWdlbmRh..."
```

### –ê–ª–≥–æ—Ä–∏—Ç–º —Ä–∞–±–æ—Ç—ã

1. **–ü—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∞—É–¥–∏–æ:**
   ```typescript
   // 1. –û—á–∏—â–∞–µ–º —Ç–µ–∫—Å—Ç
   const cleanedText = prepareTextForTTS(text, 5000)
   
   // 2. –û–ø—Ä–µ–¥–µ–ª—è–µ–º —è–∑—ã–∫
   const effectiveLanguage = getEffectiveLanguage(text, lang)
   
   // 3. –°–æ–∑–¥–∞—ë–º —Ö–µ—à
   const textHash = hashText(cleanedText, effectiveLanguage)
   
   // 4. –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—ç—à
   const cached = audioCacheRef.current.get(textHash)
   
   if (cached) {
     console.log('[useTTS] üíæ Using cached audio')
     audioUrl = cached.url  // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π!
   } else {
     console.log('[useTTS] üé§ Generating NEW audio')
     audioUrl = await ttsClient.generateSpeechURL(cleanedText, lang)
     audioCacheRef.current.set(textHash, { url: audioUrl, lang })
   }
   ```

2. **–ü—Ä–∏ –ø–∞—É–∑–µ/–ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–∏:**
   - `audioRef.current` —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è (–Ω–µ —É–¥–∞–ª—è–µ—Ç—Å—è)
   - –ü—Ä–æ—Å—Ç–æ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `audio.pause()` –∏–ª–∏ `audio.play()`
   - **–ù–æ–≤–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ù–ï –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç!**

3. **–ü—Ä–∏ —Å–º–µ–Ω–µ —Ç–µ–∫—Å—Ç–∞:**
   - –ù–æ–≤—ã–π —Ö–µ—à ‚Üí –Ω–æ–≤–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
   - –°—Ç–∞—Ä—ã–π —Ö–µ—à —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ –∫—ç—à–µ (–º–æ–∂–µ—Ç –ø–æ–Ω–∞–¥–æ–±–∏—Ç—å—Å—è —Å–Ω–æ–≤–∞)

### –§—É–Ω–∫—Ü–∏—è —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è

```typescript
const hashText = (text: string, lang: 'kk' | 'ru'): string => {
  // –ü—Ä–æ—Å—Ç–æ–π —á–∏—Å–ª–µ–Ω–Ω—ã–π —Ö–µ—à –¥–ª—è Unicode-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
  let hash = 0
  const sample = text.substring(0, 100) + text.substring(Math.max(0, text.length - 100))
  
  for (let i = 0; i < sample.length; i++) {
    const char = sample.charCodeAt(i)
    hash = ((hash << 5) - hash) + char
    hash = hash & hash // Convert to 32-bit integer
  }
  
  return `${lang}-${text.length}-${Math.abs(hash).toString(36)}`
}
```

**–ü–æ—á–µ–º—É —Ç–∞–∫–æ–π —Ö–µ—à:**
- ‚úÖ –ë—ã—Å—Ç—Ä—ã–π (–æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤—ã–±–æ—Ä–∫—É –∏–∑ 200 —Å–∏–º–≤–æ–ª–æ–≤)
- ‚úÖ Unicode-–±–µ–∑–æ–ø–∞—Å–Ω—ã–π (—Ä–∞–±–æ—Ç–∞–µ—Ç —Å –∫–∏—Ä–∏–ª–ª–∏—Ü–µ–π, –∫–∞–∑–∞—Ö—Å–∫–∏–º–∏ —Å–∏–º–≤–æ–ª–∞–º–∏)
- ‚úÖ –£–Ω–∏–∫–∞–ª—å–Ω—ã–π (–∫–æ–º–±–∏–Ω–∞—Ü–∏—è —è–∑—ã–∫–∞, –¥–ª–∏–Ω—ã –∏ —á–∏—Å–ª–µ–Ω–Ω–æ–≥–æ —Ö–µ—à–∞)
- ‚úÖ –ö–æ—Ä–æ—Ç–∫–∏–π (base36 –¥–ª—è –∫–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç–∏)
- ‚ùå –ù–µ –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π (–Ω–æ –Ω–∞–º –Ω–µ –Ω—É–∂–Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, —Ç–æ–ª—å–∫–æ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å)

**–ü—Ä–∏–º–µ—Ä—ã —Ö–µ—à–µ–π:**
- `ru-5247-1a2b3c4d` - —Ä—É—Å—Å–∫–∏–π —Ç–µ–∫—Å—Ç, 5247 —Å–∏–º–≤–æ–ª–æ–≤
- `kk-4995-9z8y7x6w` - –∫–∞–∑–∞—Ö—Å–∫–∏–π —Ç–µ–∫—Å—Ç, 4995 —Å–∏–º–≤–æ–ª–æ–≤
- `en-3210-5e4f3g2h` - –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —Ç–µ–∫—Å—Ç, 3210 —Å–∏–º–≤–æ–ª–æ–≤

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é

1. **–í–æ –≤—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã:**
   - Blob URL —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ Map
   - –ù–µ —É–¥–∞–ª—è—é—Ç—Å—è –ø—Ä–∏ –ø–∞—É–∑–µ/–æ—Å—Ç–∞–Ω–æ–≤–∫–µ
   - –ü–æ–∑–≤–æ–ª—è—é—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –≤–æ–∑–æ–±–Ω–æ–≤–∏—Ç—å –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ

2. **–ü—Ä–∏ unmount –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞:**
   ```typescript
   const cleanupCache = () => {
     audioCacheRef.current.forEach(({ url }) => {
       URL.revokeObjectURL(url)  // –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º –ø–∞–º—è—Ç—å
     })
     audioCacheRef.current.clear()
   }
   ```

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –î–æ (–±–µ–∑ –∫—ç—à–∞):
```
1. –ö–ª–∏–∫ "–û–∑–≤—É—á–∏—Ç—å" ‚Üí –≥–µ–Ω–µ—Ä–∞—Ü–∏—è 32 —Å–µ–∫—É–Ω–¥—ã ‚Üí –∏–≥—Ä–∞–µ—Ç
2. –ö–ª–∏–∫ "–ü–∞—É–∑–∞" ‚Üí –ø–∞—É–∑–∞
3. –ö–ª–∏–∫ "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å" ‚Üí –≥–µ–Ω–µ—Ä–∞—Ü–∏—è 32 —Å–µ–∫—É–Ω–¥—ã (!) ‚Üí –∏–≥—Ä–∞–µ—Ç
```

### –ü–æ—Å–ª–µ (—Å –∫—ç—à–µ–º):
```
1. –ö–ª–∏–∫ "–û–∑–≤—É—á–∏—Ç—å" ‚Üí –≥–µ–Ω–µ—Ä–∞—Ü–∏—è 32 —Å–µ–∫—É–Ω–¥—ã ‚Üí –∏–≥—Ä–∞–µ—Ç
2. –ö–ª–∏–∫ "–ü–∞—É–∑–∞" ‚Üí –ø–∞—É–∑–∞
3. –ö–ª–∏–∫ "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å" ‚Üí –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç (0 —Å–µ–∫—É–Ω–¥!)
```

### –õ–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏

**–ü–µ—Ä–≤–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è:**
```
[useTTS] üßπ Original text length: 5247
[useTTS] ‚ú® Cleaned text length: 4995
[useTTS] üé§ Generating NEW audio for text: –ü–£–ù–ö–¢ –ü–û–í–ï–°–¢–ö–ò –î–ù–Ø...
[useTTS] üåê Using language: kk
[useTTS] üíæ Cached audio with hash: kk-4995-VGhpcyBpcyBh...
[useTTS] üìä Cache size: 1
[TTS Proxy] üé§ Generating speech...
[TTS Proxy] ‚úÖ Speech generated, size: 2005632 bytes
```

**–ü—Ä–∏ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–∏ (–∫—ç—à):**
```
[useTTS] üíæ Using cached audio: kk-4995-VGhpcyBpcyBh...
[useTTS] ‚ñ∂Ô∏è Audio playing
```

**–ù–µ—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API!** ‚úÖ

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

1. **üöÄ –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –≤–æ–∑–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:**
   - –ü–∞—É–∑–∞/–ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
   - –ù–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

2. **üí∞ –≠–∫–æ–Ω–æ–º–∏—è —Ä–µ—Å—É—Ä—Å–æ–≤:**
   - –ú–µ–Ω—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ TTS API
   - –≠–∫–æ–Ω–æ–º–∏—è –≤—Ä–µ–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (32 —Å–µ–∫—É–Ω–¥—ã ‚Üí 0)

3. **üì¶ –£–º–Ω—ã–π –∫—ç—à:**
   - –†–∞–∑–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã ‚Üí —Ä–∞–∑–Ω—ã–µ –∫—ç—à-–∑–∞–ø–∏—Å–∏
   - –†–∞–∑–Ω—ã–µ —è–∑—ã–∫–∏ ‚Üí —Ä–∞–∑–Ω—ã–µ –∫—ç—à-–∑–∞–ø–∏—Å–∏
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ unmount

4. **üîÑ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫:**
   - –í–∫–ª–∞–¥–∫–∞ 1 ‚Üí –≥–µ–Ω–µ—Ä–∞—Ü–∏—è ‚Üí –∫—ç—à
   - –í–∫–ª–∞–¥–∫–∞ 2 ‚Üí –≥–µ–Ω–µ—Ä–∞—Ü–∏—è ‚Üí –∫—ç—à
   - –í–∫–ª–∞–¥–∫–∞ 1 —Å–Ω–æ–≤–∞ ‚Üí –∏–∑ –∫—ç—à–∞!

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –±–∞–≥–∏

### Bug: InvalidCharacterError with btoa()

**–ü—Ä–æ–±–ª–µ–º–∞:**
```
InvalidCharacterError: Failed to execute 'btoa' on 'Window': 
The string to be encoded contains characters outside of the Latin1 range.
```

**–ü—Ä–∏—á–∏–Ω–∞:**
- –§—É–Ω–∫—Ü–∏—è `btoa()` —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å Latin1 —Å–∏–º–≤–æ–ª–∞–º–∏ (ASCII 0-255)
- –ö–∏—Ä–∏–ª–ª–∏—Ü–∞ –∏ –∫–∞–∑–∞—Ö—Å–∫–∏–µ —Å–∏–º–≤–æ–ª—ã (”ô, “ì, “õ, “£, ”©, “±, “Ø, “ª, —ñ) –≤—ã–∑—ã–≤–∞–ª–∏ –æ—à–∏–±–∫—É

**–†–µ—à–µ–Ω–∏–µ:**
- –ó–∞–º–µ–Ω–∏–ª–∏ `btoa()` –Ω–∞ —á–∏—Å–ª–µ–Ω–Ω—ã–π —Ö–µ—à-–∞–ª–≥–æ—Ä–∏—Ç–º
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `charCodeAt()` –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±—ã–º–∏ Unicode —Å–∏–º–≤–æ–ª–∞–º–∏
- –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –≤ base36 –¥–ª—è –∫–æ–º–ø–∞–∫—Ç–Ω–æ—Å—Ç–∏

**–î–æ:**
```typescript
return `${lang}-${text.length}-${btoa(start + end).substring(0, 50)}` // ‚ùå –û—à–∏–±–∫–∞
```

**–ü–æ—Å–ª–µ:**
```typescript
let hash = 0
for (let i = 0; i < sample.length; i++) {
  const char = sample.charCodeAt(i)
  hash = ((hash << 5) - hash) + char
}
return `${lang}-${text.length}-${Math.abs(hash).toString(36)}` // ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç
```

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **–ü–∞–º—è—Ç—å:**
   - –ö–∞–∂–¥–æ–µ –∞—É–¥–∏–æ ~2MB
   - –ö—ç—à —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ RAM
   - –û—á–∏—â–∞–µ—Ç—Å—è –ø—Ä–∏ unmount –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞

2. **–•–µ—à –∫–æ–ª–ª–∏–∑–∏–∏:**
   - –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏ –≤–æ–∑–º–æ–∂–Ω—ã (–Ω–æ –º–∞–ª–æ–≤–µ—Ä–æ—è—Ç–Ω—ã)
   - –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç –æ–¥–∏–Ω–∞–∫–æ–≤–æ–π –¥–ª–∏–Ω—ã –∏ –∫—Ä–∞—ë–≤ ‚Üí –±—É–¥–µ—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ö–µ—à
   - –ß–∏—Å–ª–µ–Ω–Ω—ã–π —Ö–µ—à –±–æ–ª–µ–µ —É—Å—Ç–æ–π—á–∏–≤ –∫ –∫–æ–ª–ª–∏–∑–∏—è–º —á–µ–º –ø—Ä–æ—Å—Ç–æ–π base64

3. **–ë–µ–∑ –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏:**
   - –ö—ç—à –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏
   - –ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ‚Üí –Ω–æ–≤–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è

## –í–æ–∑–º–æ–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

### 1. LocalStorage/IndexedDB –∫—ç—à
```typescript
// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ IndexedDB –¥–ª—è –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è
await db.audioCache.put({ hash, blob, timestamp })
```

### 2. LRU –∫—ç—à —Å –ª–∏–º–∏—Ç–æ–º
```typescript
// –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –∫—ç—à–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 10 –∑–∞–ø–∏—Å–µ–π)
if (audioCacheRef.current.size > 10) {
  const oldestKey = Array.from(audioCacheRef.current.keys())[0]
  audioCacheRef.current.delete(oldestKey)
}
```

### 3. –ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π —Ö–µ—à
```typescript
// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Web Crypto API –¥–ª—è –±–æ–ª–µ–µ –Ω–∞–¥—ë–∂–Ω–æ–≥–æ —Ö–µ—à–∞
const hashBuffer = await crypto.subtle.digest('SHA-256', textEncoder.encode(text))
const hashArray = Array.from(new Uint8Array(hashBuffer))
const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('')
```

### 4. Preloading —Å–ª–µ–¥—É—é—â–µ–π –≤–∫–ª–∞–¥–∫–∏
```typescript
// –ü—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∞ –∞—É–¥–∏–æ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–π –≤–∫–ª–∞–¥–∫–∏ –≤ —Ñ–æ–Ω–µ
useEffect(() => {
  if (activeTab === 'vnd') {
    // Preload 'legal' tab audio
    preloadAudio(analysisResult.legal)
  }
}, [activeTab])
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. **–ë–∞–∑–æ–≤—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π:**
   - –ù–∞–∂–∞—Ç—å "–û–∑–≤—É—á–∏—Ç—å" ‚Üí –∂–¥–∞—Ç—å 32 —Å–µ–∫ ‚Üí –∏–≥—Ä–∞–µ—Ç
   - –ù–∞–∂–∞—Ç—å "–ü–∞—É–∑–∞" ‚Üí –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
   - –ù–∞–∂–∞—Ç—å "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å" ‚Üí –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç ‚úÖ

2. **–ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫:**
   - –í–∫–ª–∞–¥–∫–∞ VND ‚Üí "–û–∑–≤—É—á–∏—Ç—å" ‚Üí –∂–¥–∞—Ç—å ‚Üí –∏–≥—Ä–∞–µ—Ç
   - –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –Ω–∞ Legal ‚Üí "–û–∑–≤—É—á–∏—Ç—å" ‚Üí –∂–¥–∞—Ç—å ‚Üí –∏–≥—Ä–∞–µ—Ç
   - –í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ VND ‚Üí "–û–∑–≤—É—á–∏—Ç—å" ‚Üí –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –∏–∑ –∫—ç—à–∞ ‚úÖ

3. **–°–º–µ–Ω–∞ —è–∑—ã–∫–∞:**
   - –†—É—Å—Å–∫–∏–π ‚Üí "–û–∑–≤—É—á–∏—Ç—å" ‚Üí –∫—ç—à ru-5000-...
   - –ê–Ω–≥–ª–∏–π—Å–∫–∏–π ‚Üí "–û–∑–≤—É—á–∏—Ç—å" ‚Üí –∫—ç—à en-5000-...
   - –†—É—Å—Å–∫–∏–π —Å–Ω–æ–≤–∞ ‚Üí –∏–∑ –∫—ç—à–∞ ‚úÖ

## –ö–æ–¥ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –§–∞–π–ª—ã:
- `src/hooks/useTTS.ts` - –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
- `src/app/virtual-director/page.tsx` - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ö—É–∫–∞

### –ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:
1. –î–æ–±–∞–≤–ª–µ–Ω `audioCacheRef` (Map)
2. –§—É–Ω–∫—Ü–∏—è `hashText()` –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–ª—é—á–µ–π
3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∞ –≤ `generateAndPlay()`
4. –§—É–Ω–∫—Ü–∏—è `cleanupCache()` –¥–ª—è –æ—á–∏—Å—Ç–∫–∏
5. –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—ç—à–∞

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ  
**–î–∞—Ç–∞:** 6 –æ–∫—Ç—è–±—Ä—è 2025 –≥.
