# –°–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ–∑–≤—É—á–∫–∏ –¥–ª—è –¥–µ–º–æ —Ä–µ–∂–∏–º–∞ Virtual Director

## –û–±–∑–æ—Ä

–°–∏—Å—Ç–µ–º–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞—Ä–∞–Ω–µ–µ –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –æ–∑–≤—É—á–∫—É –¥–ª—è –¥–µ–º–æ –¥–∞–Ω–Ω—ã—Ö Virtual Director, —á—Ç–æ–±—ã —É—Å–∫–æ—Ä–∏—Ç—å –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—é –∏ —Å–Ω–∏–∑–∏—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ TTS API –≤–æ –≤—Ä–µ–º—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

1. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (DialogSettings)**
   - –ö–ª—é—á–∏: `virtual-director-demo-audio-{lang}` (ru, kk, en)
   - –ó–Ω–∞—á–µ–Ω–∏–µ: JSON —Å —Ç—Ä–µ–º—è –∞—É–¥–∏–æ —Ñ–∞–π–ª–∞–º–∏ –≤ base64 —Ñ–æ—Ä–º–∞—Ç–µ (vnd, np, summary)

2. **API Endpoints**
   - `POST /api/admin/virtual-director-settings/generate-audio` - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ–∑–≤—É—á–∫–∏
   - `GET /api/admin/virtual-director-settings/audio?lang={lang}` - –ü–æ–ª—É—á–µ–Ω–∏–µ –æ–∑–≤—É—á–∫–∏

3. **–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å** (`/admin/virtual-director`)
   - –í—ã–±–æ—Ä —è–∑—ã–∫–∞ –æ–∑–≤—É—á–∫–∏ (ru/kk/en)
   - –ö–Ω–æ–ø–∫–∞ "–û–∑–≤—É—á–∏—Ç—å" –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
   - –ò–Ω–¥–∏–∫–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

4. **Virtual Director** (`/virtual-director`)
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–µ–¥–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –æ–∑–≤—É—á–∫–∏ –≤ –¥–µ–º–æ —Ä–µ–∂–∏–º–µ
   - Fallback –Ω–∞ live –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –µ—Å–ª–∏ –æ–∑–≤—É—á–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞
   - –û–±—ã—á–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ

## –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

### 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–µ–º–æ –¥–∞–Ω–Ω—ã—Ö

1. –û—Ç–∫—Ä–æ–π—Ç–µ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å: http://localhost:3000/admin/virtual-director
2. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –Ω–∞ –≤–∫–ª–∞–¥–∫—É "–î–µ–º–æ —Ä–µ–∂–∏–º"
3. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –Ω–∞ —Ç—Ä–µ—Ö —è–∑—ã–∫–∞—Ö (ru, kk, en)
4. –ù–∞–∂–º–∏—Ç–µ "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏"

### 2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ–∑–≤—É—á–∫–∏

1. –í –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ —è–∑—ã–∫ –∏–∑ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞
2. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "üé§ –û–∑–≤—É—á–∏—Ç—å"
3. –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (–º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å 30-60 —Å–µ–∫—É–Ω–¥)
4. –°–∏—Å—Ç–µ–º–∞ –ø–æ–∫–∞–∂–µ—Ç —Ä–∞–∑–º–µ—Ä—ã —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
5. –ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –¥–ª—è –¥—Ä—É–≥–∏—Ö —è–∑—ã–∫–æ–≤ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

### 3. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ –¥–µ–º–æ —Ä–µ–∂–∏–º–µ

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É Virtual Director: http://localhost:3000/virtual-director
2. –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∑–∏—Ç –ø—Ä–µ–¥–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—É—é –æ–∑–≤—É—á–∫—É
3. –û–∑–≤—É—á–∫–∞ –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤–∞ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∞–ª–∏–∑–∞
4. –ù–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –§–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è

```json
{
  "vnd": "data:audio/mpeg;base64,...",
  "np": "data:audio/mpeg;base64,...",
  "summary": "data:audio/mpeg;base64,...",
  "generatedAt": "2025-01-16T10:30:00.000Z"
}
```

### –†–∞–∑–º–µ—Ä—ã —Ñ–∞–π–ª–æ–≤

–¢–∏–ø–∏—á–Ω—ã–µ —Ä–∞–∑–º–µ—Ä—ã –∞—É–¥–∏–æ —Ñ–∞–π–ª–æ–≤:
- –í–ù–î: 50-150 KB
- –ù–ü–ê: 50-150 KB  
- –ò—Ç–æ–≥–∏: 30-80 KB

**–û–±—â–∏–π —Ä–∞–∑–º–µ—Ä –Ω–∞ —è–∑—ã–∫: ~200-400 KB**

### –ü—Ä–æ—Ü–µ—Å—Å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

1. –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–µ–º–æ –¥–∞–Ω–Ω—ã–µ –∏–∑ –ë–î
2. –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç—ã –¥–ª—è —Ç—Ä–µ—Ö –≤–∫–ª–∞–¥–æ–∫ –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–º —è–∑—ã–∫–µ
3. –û—á–∏—â–∞–µ–º —Ç–µ–∫—Å—Ç—ã –æ—Ç Markdown (prepareTextForTTS)
4. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∞—É–¥–∏–æ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —á–µ—Ä–µ–∑ TTS API
5. –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ base64 data URIs
6. –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –ë–î —Å –∫–ª—é—á–æ–º `virtual-director-demo-audio-{lang}`

### –ü—Ä–æ—Ü–µ—Å—Å –∑–∞–≥—Ä—É–∑–∫–∏

**–î–µ–º–æ —Ä–µ–∂–∏–º:**
1. –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –∞—É–¥–∏–æ —á–µ—Ä–µ–∑ API
2. –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º data URIs –≤ blob URLs
3. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å –Ω–∞ 100%
4. –ï—Å–ª–∏ –∞—É–¥–∏–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ - fallback –Ω–∞ live –≥–µ–Ω–µ—Ä–∞—Ü–∏—é

**–†–µ–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º:**
- –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –æ–∑–≤—É—á–∫—É –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ —á–µ—Ä–µ–∑ preloadTTSAudio
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∞—è –ª–æ–≥–∏–∫–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

‚úÖ **–ë—ã—Å—Ç—Ä–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è** - –æ–∑–≤—É—á–∫–∞ –≥–æ—Ç–æ–≤–∞ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
‚úÖ **–°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏** - TTS API –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º –¥–µ–º–æ
‚úÖ **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** - fallback –Ω–∞ live –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏
‚úÖ **–ì–∏–±–∫–æ—Å—Ç—å** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç—Ä–µ—Ö —è–∑—ã–∫–æ–≤
‚úÖ **–ü—Ä–æ—Å—Ç–æ—Ç–∞** - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –≤ –æ–¥–∏–Ω –∫–ª–∏–∫

## Troubleshooting

### –û–∑–≤—É—á–∫–∞ –Ω–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –æ–∑–≤—É—á–∫–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è –Ω—É–∂–Ω–æ–≥–æ —è–∑—ã–∫–∞
2. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
3. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ TTS API –¥–æ—Å—Ç—É–ø–µ–Ω (https://tts.sk-ai.kz)

### –û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –¥–µ–º–æ –¥–∞–Ω–Ω—ã–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —É –≤–∞—Å –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å TTS API
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞

### –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç —Ç–µ–∫—Å—Ç –¥–æ 5000 —Å–∏–º–≤–æ–ª–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–π –≤–∫–ª–∞–¥–∫–∏ —á–µ—Ä–µ–∑ `prepareTextForTTS`. –ï—Å–ª–∏ —Ä–∞–∑–º–µ—Ä—ã –≤—Å–µ —Ä–∞–≤–Ω–æ –±–æ–ª—å—à–∏–µ:

1. –°–æ–∫—Ä–∞—Ç–∏—Ç–µ –¥–µ–º–æ —Ç–µ–∫—Å—Ç—ã –≤ –∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª–∏
2. –£–º–µ–Ω—å—à–∏—Ç–µ –ª–∏–º–∏—Ç –≤ `generate-audio/route.ts` (—Å—Ç—Ä–æ–∫–∞ —Å prepareTextForTTS)

## API Reference

### POST /api/admin/virtual-director-settings/generate-audio

–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ–∑–≤—É—á–∫—É –¥–ª—è –¥–µ–º–æ –¥–∞–Ω–Ω—ã—Ö.

**Request:**
```json
{
  "lang": "ru" // –∏–ª–∏ "kk", "en"
}
```

**Response:**
```json
{
  "success": true,
  "message": "Audio generated and saved successfully",
  "lang": "ru",
  "sizes": {
    "vnd": 102400,
    "np": 98304,
    "summary": 51200
  }
}
```

### GET /api/admin/virtual-director-settings/audio?lang=ru

–ü–æ–ª—É—á–∞–µ—Ç –ø—Ä–µ–¥–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—É—é –æ–∑–≤—É—á–∫—É.

**Response:**
```json
{
  "success": true,
  "audio": {
    "vnd": "data:audio/mpeg;base64,...",
    "np": "data:audio/mpeg;base64,...",
    "summary": "data:audio/mpeg;base64,..."
  },
  "generatedAt": "2025-01-16T10:30:00.000Z"
}
```

## –§–∞–π–ª—ã

- `/src/app/api/admin/virtual-director-settings/generate-audio/route.ts` - API –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- `/src/app/api/admin/virtual-director-settings/audio/route.ts` - API –ø–æ–ª—É—á–µ–Ω–∏—è
- `/src/app/admin/virtual-director/page.tsx` - –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å
- `/src/app/virtual-director/page.tsx` - Virtual Director (–¥–µ–º–æ —Ä–µ–∂–∏–º)
- `/src/lib/tts-preloader.ts` - –£—Ç–∏–ª–∏—Ç—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ TTS
- `/src/lib/text-sanitizer.ts` - –û—á–∏—Å—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞ –æ—Ç Markdown
