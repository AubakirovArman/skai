# ะะตะบัะพัะฝัะต ะฑะฐะทั ะดะฐะฝะฝัั ะดะปั ะฟะพะธัะบะฐ ะฟะพ ะดะพะบัะผะตะฝัะฐะผ

[![PostgreSQL](https://img.shields.io/badge/PostgreSQL-17-blue.svg)](https://www.postgresql.org/)
[![pgvecto.rs](https://img.shields.io/badge/pgvecto.rs-0.4.0-green.svg)](https://github.com/tensorchord/pgvecto.rs)
[![Python](https://img.shields.io/badge/Python-3.8+-yellow.svg)](https://www.python.org/)
[![Status](https://img.shields.io/badge/Status-Ready-success.svg)]()

ะะตะบัะพัะฝัะต ะฑะฐะทั ะดะฐะฝะฝัั ะฝะฐ PostgreSQL ั pgvecto.rs ะดะปั ัะตะผะฐะฝัะธัะตัะบะพะณะพ ะฟะพะธัะบะฐ ะฟะพ ะฒะฝัััะตะฝะฝะธะผ ะฝะพัะผะฐัะธะฒะฝัะผ ะดะพะบัะผะตะฝัะฐะผ (ะะะ) ะธ ะฟัะฐะฒะพะฒัะผ ะฝะพัะผะฐะผ ะะ (ะะะ).

## ๐ฏ ะงัะพ ััะพ?

ะะฒะต ะฟะพะปะฝะพััะฝะบัะธะพะฝะฐะปัะฝัะต ะฒะตะบัะพัะฝัะต ะฑะฐะทั ะดะฐะฝะฝัั ั ะฟะพะดะดะตัะถะบะพะน:
- โ ะกะตะผะฐะฝัะธัะตัะบะพะณะพ ะฟะพะธัะบะฐ (dense ะฒะตะบัะพัั)
- โ ะะตะบัะธัะตัะบะพะณะพ ะฟะพะธัะบะฐ (sparse ะฒะตะบัะพัั)
- โ ะะพะปะฝะพัะตะบััะพะฒะพะณะพ ะฟะพะธัะบะฐ (BM25)
- โ ะะธะฑัะธะดะฝะพะณะพ ะฟะพะธัะบะฐ ั RRF
- โ HNSW ะธะฝะดะตะบัะพะฒ ะดะปั ะฑััััะพะณะพ ะฟะพะธัะบะฐ

## ๐ ะัััััะน ััะฐัั

```python
# ะฃััะฐะฝะพะฒะบะฐ
pip install psycopg2-binary sentence-transformers

# ะะพะธัะบ ะฟะพ ะะะ
from ะะะ.internal_search import internal_doc_search
results = internal_doc_search("ะฟะพะปะฝะพะผะพัะธั ัะพะฒะตัะฐ ะดะธัะตะบัะพัะพะฒ")

# ะะพะธัะบ ะฟะพ ะะะ
from ะัะฐะฒะพะฒัะต_ะฝะพัะผั.rag_npa import legal_search
results = legal_search("ะฝะฐะปะพะณะธ ะดะปั ะขะะ")
```

**ะะพะดัะพะฑะฝะตะต:** [QUICKSTART.md](./QUICKSTART.md)

## ๐ ะะพะบัะผะตะฝัะฐัะธั

| ะะพะบัะผะตะฝั | ะะฟะธัะฐะฝะธะต |
|----------|----------|
| **[INDEX.md](./INDEX.md)** | ๐๏ธ ะะฐะฒะธะณะฐัะธั ะฟะพ ะฒัะตะผ ะดะพะบัะผะตะฝัะฐะผ |
| **[QUICKSTART.md](./QUICKSTART.md)** | โก ะัััััะน ััะฐัั ะทะฐ 2 ะผะธะฝััั |
| **[README_VECTOR_DB_USAGE.md](./README_VECTOR_DB_USAGE.md)** | ๐ ะะพะปะฝะพะต ััะบะพะฒะพะดััะฒะพ |
| **[ARCHITECTURE.md](./ARCHITECTURE.md)** | ๐๏ธ ะััะธัะตะบัััะฐ ะธ ััะตะผั |
| **[SUMMARY.md](./SUMMARY.md)** | โ ะกัะฐััั ะฟัะพะตะบัะฐ |

## ๐๏ธ ะะฐะทั ะดะฐะฝะฝัั

### vnd - ะะฝัััะตะฝะฝะธะต ะฝะพัะผะฐัะธะฒะฝัะต ะดะพะบัะผะตะฝัั
```
๐ documents โ ๐ sections โ ๐ subsections
            (vector 1024)  (vector 1024)
```

### npa - ะัะฐะฒะพะฒัะต ะฝะพัะผั ะะ
```
๐ document_metadata โ ๐ content_chunks
                     (dense + sparse + tsvector)
```

**ะะพะดะบะปััะตะฝะธะต:**
```python
VND_DSN = "postgresql://postgres:***@82.200.129.219:5433/vnd"
NPA_DSN = "postgresql://postgres:***@82.200.129.219:5433/npa"
```

## ๐ง ะงัะพ ะฝัะถะฝะพ ัะดะตะปะฐัั?

1. โ ะะฐะทั ะดะฐะฝะฝัั ัะพะทะดะฐะฝั
2. โณ ะะฑะฝะพะฒะธัั ัััะพะบะธ ะฟะพะดะบะปััะตะฝะธั:
   - `ะะะ/internal_search.py` (ัััะพะบะฐ ~18)
   - `ะัะฐะฒะพะฒัะต ะฝะพัะผั/rag_npa.py` (ััะฝะบัะธั get_npa_conn)
3. โณ ะะฐะณััะทะธัั ะดะฐะฝะฝัะต (ะพะฟัะธะพะฝะฐะปัะฝะพ):
   ```bash
   python load_vnd_data.py
   ```

## ๐ก ะะปััะตะฒัะต ะพัะพะฑะตะฝะฝะพััะธ

- **ะะฐััะธัะตะฝะธะต:** pgvecto.rs (vectors) v0.4.0 ะฒะผะตััะพ pgvector
- **ะะฝะดะตะบัั:** HNSW (ะฑััััะตะต ัะตะผ IVFFlat)
- **ะะตะบัะพัั:** Dense (1024) + Sparse (250002) + BM25
- **ะะพะดะตะปั:** BAAI/bge-m3 (ัะฐะทะผะตัะฝะพััั 1024)
- **ะกะตัะฒะตั:** 82.200.129.219:5433

## ๐ ะกัะฐัะธััะธะบะฐ

```
ะะฐะทะฐ vnd:
  โโ 3 ัะฐะฑะปะธัั (documents, sections, subsections)
  โโ 8 ะธะฝะดะตะบัะพะฒ (2 HNSW + 6 B-tree)
  โโ ะะตะบัะพัั: 1024 float32

ะะฐะทะฐ npa:
  โโ 2 ัะฐะฑะปะธัั (document_metadata, content_chunks)
  โโ 6 ะธะฝะดะตะบัะพะฒ (2 HNSW + 1 GIN + 3 B-tree)
  โโ ะะตะบัะพัั: dense(1024) + sparse(250002)
```

## ๐๏ธ ะกะบัะธะฟัั

| ะกะบัะธะฟั | ะะฟะธัะฐะฝะธะต |
|--------|----------|
| `create_vector_databases_pgvectors.py` | โ ะกะพะทะดะฐะฝะธะต ะฑะฐะท (ะฒัะฟะพะปะฝะตะฝะพ) |
| `load_vnd_data.py` | ๐ฅ ะะฐะณััะทะบะฐ ะดะฐะฝะฝัั ะะะ ะธะท CSV |
| `create_databases_manual.sql` | ๐ SQL ะดะปั ัััะฝะพะณะพ ัะพะทะดะฐะฝะธั |

## ๐ ะัะธะผะตัั ะธัะฟะพะปัะทะพะฒะฐะฝะธั

### ะะพะธัะบ ะฟะพ ะะะ

```python
from ะะะ.internal_search import internal_doc_search

results = internal_doc_search(
    query="ะฟะพะปะฝะพะผะพัะธั ัะพะฒะตัะฐ ะดะธัะตะบัะพัะพะฒ",
    top_k=8,
    limit=12
)

for r in results['results']:
    print(f"[{r['similarity']:.2f}] {r['doc_title']} - {r['title']}")
    print(f"  {r['text'][:200]}...")
```

### ะะพะธัะบ ะฟะพ ะะะ ั ะณะตะฝะตัะฐัะธะตะน ะพัะฒะตัะฐ

```python
from ะัะฐะฒะพะฒัะต_ะฝะพัะผั.rag_npa import legal_search, legal_generate_answer

# ะะพะธัะบ
results = legal_search("ะฝะฐะปะพะณะธ ะดะปั ะขะะ", top_k=5)

# ะะตะฝะตัะฐัะธั ะพัะฒะตัะฐ ั ะธััะพัะฝะธะบะฐะผะธ
answer = legal_generate_answer(results['query'], results['results'])
print(answer)
```

## โ FAQ

**Q: ะัะถะฝะพ ะปะธ ัััะฐะฝะฐะฒะปะธะฒะฐัั ะผะพะดะตะปั ัะผะฑะตะดะดะธะฝะณะพะฒ?**  
A: ะะปั ะธัะฟะพะปัะทะพะฒะฐะฝะธั ััะฝะบัะธะน `internal_doc_search()` ะธ `legal_search()` - ะะะข (ัะพะทะดะฐะตััั ะฐะฒัะพะผะฐัะธัะตัะบะธ). ะะปั ะทะฐะณััะทะบะธ ะฝะพะฒัั ะดะฐะฝะฝัั - ะะ.

**Q: ะะฐะบัั ะผะพะดะตะปั ะธัะฟะพะปัะทะพะฒะฐัั?**  
A: BAAI/bge-m3 (ัะฐะทะผะตัะฝะพััั 1024, ะฟะพะดะดะตัะถะบะฐ ััััะบะพะณะพ ัะทัะบะฐ)

**Q: ะะดะต ััะฐะฝะธััั ะฟะฐัะพะปั?**  
A: ะ ัะฐะนะปะฐั ะดะพะบัะผะตะฝัะฐัะธะธ. ะะปั production ะธัะฟะพะปัะทัะนัะต ะฟะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั.

**Q: ะะฐะบ ะพะฑะฝะพะฒะธัั ัััะตััะฒัััะธะน ะบะพะด?**  
A: ะะทะผะตะฝะธัะต ัััะพะบะธ ะฟะพะดะบะปััะตะฝะธั (DSN) ะฒ ัะฐะนะปะฐั `internal_search.py` ะธ `rag_npa.py`

**ะะพะปััะต ะฒะพะฟัะพัะพะฒ:** [README_VECTOR_DB_USAGE.md - FAQ](./README_VECTOR_DB_USAGE.md#-ัะฐัััะต-ะฟัะพะฑะปะตะผั)

## ๐๏ธ ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ   PostgreSQL + pgvecto.rs v0.4.0    โ
โ   82.200.129.219:5433               โ
โโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโค
โ   ะะฐะทะฐ vnd       โ   ะะฐะทะฐ npa       โ
โ   (ะะะ)          โ   (ะะะ ะะ)       โ
โโโโโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโโโโ
         โฒ                  โฒ
         โ                  โ
         โโโโโโโโโโโโโโโโโโโโ
                  โ
         โโโโโโโโโโดโโโโโโโโโ
         โ  ะะฐั ะบะพะด Python โ
         โ  + BAAI/bge-m3  โ
         โโโโโโโโโโโโโโโโโโโ
```

**ะะพะดัะพะฑะฝะตะต:** [ARCHITECTURE.md](./ARCHITECTURE.md)

## ๐ฆ ะะฐะฒะธัะธะผะพััะธ

```bash
pip install psycopg2-binary sentence-transformers torch numpy FlagEmbedding
```

## ๐ ะะตะทะพะฟะฐัะฝะพััั

โ๏ธ **ะะฐัะพะปะธ ะฒ ะบะพะดะต - ัะพะปัะบะพ ะดะปั ัะฐะทัะฐะฑะพัะบะธ!**

ะะปั production ะธัะฟะพะปัะทัะนัะต:
```bash
# .env ัะฐะนะป
VND_DB_DSN=postgresql://...
NPA_DB_DSN=postgresql://...
OPENAI_API_KEY=sk-...
```

## ๐ ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั

- **ะะพะธัะบ:** ~10-50ms ะดะปั top-10 ัะตะทัะปััะฐัะพะฒ
- **ะะฝะดะตะบัั:** HNSW (m=16, ef=64)
- **ะะฐะผััั:** ~4KB ะฝะฐ ะฒะตะบัะพั (1024 float32)
- **ะะฐัััะฐะฑะธัะพะฒะฐะฝะธะต:** ะดะพ ะผะธะปะปะธะพะฝะพะฒ ะฒะตะบัะพัะพะฒ

## ๐ค ะฃัะฐััะธะต

ะัะพะตะบั ัะพะทะดะฐะฝ ะดะปั ะฒะฝัััะตะฝะฝะตะณะพ ะธัะฟะพะปัะทะพะฒะฐะฝะธั. ะะพะบัะผะตะฝัะฐัะธั ะธ ะฟัะธะผะตัั ะพัะบัััั.

## ๐ ะะธัะตะฝะทะธั

ะะฝัััะตะฝะฝะธะน ะฟัะพะตะบั.

## ๐ ะะพะดะดะตัะถะบะฐ

1. ะัะพะฒะตัััะต [INDEX.md](./INDEX.md) ะดะปั ะฝะฐะฒะธะณะฐัะธะธ
2. ะกะผะพััะธัะต [ะงะฐัััะต ะฟัะพะฑะปะตะผั](./README_VECTOR_DB_USAGE.md#-ัะฐัััะต-ะฟัะพะฑะปะตะผั)
3. ะงะธัะฐะนัะต ะปะพะณะธ PostgreSQL

---

**ะกะพะทะดะฐะฝะพ:** 5 ัะฝะฒะฐัั 2025  
**ะะตััะธั:** 1.0  
**ะกัะฐััั:** โ ะะพัะพะฒะพ ะบ ะธัะฟะพะปัะทะพะฒะฐะฝะธั

**ะะฐัะฝะธัะต ั [QUICKSTART.md](./QUICKSTART.md) โ**
