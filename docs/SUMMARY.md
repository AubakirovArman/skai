# –†–µ–∑—é–º–µ: –í–µ–∫—Ç–æ—Ä–Ω—ã–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–Ω—ã ‚úÖ

## üéâ –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ

1. ‚úÖ **–°–æ–∑–¥–∞–Ω—ã 2 –≤–µ–∫—Ç–æ—Ä–Ω—ã–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö** –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ PostgreSQL
   - `vnd` - –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
   - `npa` - –¥–ª—è –ø—Ä–∞–≤–æ–≤—ã—Ö –Ω–æ—Ä–º –†–ö

2. ‚úÖ **–£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ pgvecto.rs (vectors v0.4.0)**
   - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ dense –∏ sparse –≤–µ–∫—Ç–æ—Ä–æ–≤
   - –ê–ª–≥–æ—Ä–∏—Ç–º HNSW –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
   - –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ (Dense + Sparse + BM25)

3. ‚úÖ **–°–æ–∑–¥–∞–Ω—ã –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã –∏ –∏–Ω–¥–µ–∫—Å—ã**
   - 3 —Ç–∞–±–ª–∏—Ü—ã –≤ `vnd`: documents, sections, subsections
   - 2 —Ç–∞–±–ª–∏—Ü—ã –≤ `npa`: document_metadata, content_chunks
   - –í–µ–∫—Ç–æ—Ä–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã HNSW
   - –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–µ –∏–Ω–¥–µ–∫—Å—ã GIN

## üìÇ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### –û—Å–Ω–æ–≤–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã
1. **`create_vector_databases_pgvectors.py`** ‚≠ê
   - –ì–ª–∞–≤–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö
   - –£—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω, –±–∞–∑—ã —Å–æ–∑–¥–∞–Ω—ã

2. **`load_vnd_data.py`** ‚≠ê
   - –°–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏–∑ CSV –≤ –±–∞–∑—É vnd
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç —ç–º–±–µ–¥–¥–∏–Ω–≥–∏

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
3. **`README_VECTOR_DB_USAGE.md`** ‚≠ê‚≠ê‚≠ê
   - **–ì–õ–ê–í–ù–ê–Ø –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø**
   - –ü–æ–¥—Ä–æ–±–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
   - –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞
   - –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

4. **`QUICKSTART.md`** ‚≠ê‚≠ê
   - –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
   - –ú–∏–Ω–∏–º—É–º –∫–æ–¥–∞ –¥–ª—è –Ω–∞—á–∞–ª–∞ —Ä–∞–±–æ—Ç—ã

5. **`README_DATABASES.md`**
   - –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–∞–∑–∞—Ö –¥–∞–Ω–Ω—ã—Ö
   - –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü
   - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

### –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã
6. **`create_databases_manual.sql`**
   - SQL –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è
   - –ù–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ Python —Å–∫—Ä–∏–ø—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

7. **`install_pgvector_instructions.md`**
   - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ pgvector
   - (–≤ –∏—Ç–æ–≥–µ –Ω–µ –ø–æ–Ω–∞–¥–æ–±–∏–ª–æ—Å—å, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è pgvecto.rs)

8. **`create_vector_databases_simple.py`**
   - –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è —Å–∫—Ä–∏–ø—Ç–∞
   - –ë–µ–∑ sparse –≤–µ–∫—Ç–æ—Ä–æ–≤

## üîë –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

```python
# –ë–∞–∑–∞ –í–ù–î
VND_DSN = "postgresql://<user>:<password>@<host>:<port>/vnd"

# –ë–∞–∑–∞ –ù–ü–ê  
NPA_DSN = "postgresql://<user>:<password>@<host>:<port>/npa"
```

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö

### –ë–∞–∑–∞ vnd (–í–ù–î)
```
documents (3 –∑–∞–ø–∏—Å–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
  ‚îî‚îÄ sections (—Å —ç–º–±–µ–¥–¥–∏–Ω–≥–∞–º–∏ vector(1024))
      ‚îî‚îÄ subsections (—Å —ç–º–±–µ–¥–¥–∏–Ω–≥–∞–º–∏ vector(1024))
```

### –ë–∞–∑–∞ npa (–ù–ü–ê)
```
document_metadata
  ‚îî‚îÄ content_chunks (—Å dense + sparse + tsvector)
```

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –û–±–Ω–æ–≤–∏—Ç–µ connection strings –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º –∫–æ–¥–µ

**–§–∞–π–ª `–í–ù–î/internal_search.py`:**
```python
# –°—Ç—Ä–æ–∫–∞ ~18
DB_DSN: str = Field(default="postgresql://<user>:<password>@<host>:<port>/vnd")
```

**–§–∞–π–ª `–ü—Ä–∞–≤–æ–≤—ã–µ –Ω–æ—Ä–º—ã/rag_npa.py`:**
```python
# –§—É–Ω–∫—Ü–∏—è get_npa_conn
def get_npa_conn():
    return psycopg2.connect(
        "postgresql://<user>:<password>@<host>:<port>/npa"
    )
```

### 2. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

```bash
# –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –í–ù–î –∏–∑ CSV
python load_vnd_data.py
```

### 3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–æ—Ç–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

```python
# –í–ù–î
from –í–ù–î.internal_search import internal_doc_search
results = internal_doc_search("–ø–æ–ª–Ω–æ–º–æ—á–∏—è —Å–æ–≤–µ—Ç–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–æ–≤")

# –ù–ü–ê
from –ü—Ä–∞–≤–æ–≤—ã–µ_–Ω–æ—Ä–º—ã.rag_npa import legal_search
results = legal_search("–Ω–∞–ª–æ–≥–∏ –¥–ª—è –¢–û–û")
```

## ‚ùì –ù—É–∂–Ω—ã –ª–∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏?

### –î–ª—è –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–Ø —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π:
**–ù–ï–¢** - —ç–º–±–µ–¥–¥–∏–Ω–≥–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–Ω—É—Ç—Ä–∏ —Ñ—É–Ω–∫—Ü–∏–π `internal_doc_search()` –∏ `legal_search()`

### –î–ª—è –ó–ê–ì–†–£–ó–ö–ò –Ω–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö:
**–î–ê** - –Ω—É–∂–Ω–∞ –º–æ–¥–µ–ª—å –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤:
```python
from sentence_transformers import SentenceTransformer
model = SentenceTransformer("BAAI/bge-m3")
```

## üîß –ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ?

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ
–ï—Å–ª–∏ CSV —Ñ–∞–π–ª—ã —É–∂–µ —Å–æ–¥–µ—Ä–∂–∞—Ç —ç–º–±–µ–¥–¥–∏–Ω–≥–∏, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `load_vnd_data.py`

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ó–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
–°–º. –ø—Ä–∏–º–µ—Ä—ã –≤ `README_VECTOR_DB_USAGE.md` —Ä–∞–∑–¥–µ–ª "–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö"

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ü—Ä–æ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
–û–±–Ω–æ–≤–∏—Ç–µ connection strings –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `internal_doc_search()` –∏ `legal_search()`

## üìö –ì–ª–∞–≤–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –¥–ª—è —á—Ç–µ–Ω–∏—è

1. **`README_VECTOR_DB_USAGE.md`** - –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ
2. **`QUICKSTART.md`** - –±—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –±–∞–∑–µ
PGPASSWORD='<password>' psql -h <host> -p <port> -U <user> -d vnd

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–∞–±–ª–∏—Ü—ã
\dt

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω–¥–µ–∫—Å—ã
\di

# –í—ã–π—Ç–∏
\q
```

## üöÄ –°—Ç–∞—Ç—É—Å

- [x] –ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–Ω—ã
- [x] –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ vectors —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
- [x] –¢–∞–±–ª–∏—Ü—ã –∏ –∏–Ω–¥–µ–∫—Å—ã —Å–æ–∑–¥–∞–Ω—ã
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞–ø–∏—Å–∞–Ω–∞
- [x] –°–∫—Ä–∏–ø—Ç—ã –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≥–æ—Ç–æ–≤—ã
- [ ] –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã (—Ç—Ä–µ–±—É–µ—Ç—Å—è –∑–∞–ø—É—Å—Ç–∏—Ç—å `load_vnd_data.py`)
- [ ] Connection strings –æ–±–Ω–æ–≤–ª–µ–Ω—ã –≤ `internal_search.py` –∏ `rag_npa.py`

## üí° –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥

**–û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–æ–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤ –≤–∞—à–∏—Ö —Ñ–∞–π–ª–∞—Ö:**
- `–í–ù–î/internal_search.py`
- `–ü—Ä–∞–≤–æ–≤—ã–µ –Ω–æ—Ä–º—ã/rag_npa.py`

–ó–∞—Ç–µ–º –≤–∞—à –∫–æ–¥ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å –Ω–æ–≤—ã–º–∏ –≤–µ–∫—Ç–æ—Ä–Ω—ã–º–∏ –±–∞–∑–∞–º–∏ –Ω–∞ —É–¥–∞–ª–µ–Ω–Ω–æ–º —Å–µ—Ä–≤–µ—Ä–µ!

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 5 —è–Ω–≤–∞—Ä—è 2025  
**–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ:** pgvecto.rs (vectors) v0.4.0  
**–°–µ—Ä–≤–µ—Ä:** –°–º. `.env.local` –¥–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
