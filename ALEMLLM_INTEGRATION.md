# ะะฝัะตะณัะฐัะธั AlemLLM ะธ PostgreSQL ะฒะตะบัะพัะฝัั ะฑะฐะท

## ๐ ะงัะพ ะฑัะปะพ ัะดะตะปะฐะฝะพ

ะัะต ััะธ API endpoint ััะฟะตัะฝะพ ะฟะตัะตะฒะตะดะตะฝั ะฝะฐ ะธัะฟะพะปัะทะพะฒะฐะฝะธะต:
- โ **AlemLLM API** ะฒะผะตััะพ OpenAI
- โ **PostgreSQL ะฒะตะบัะพัะฝัะต ะฑะฐะทั** (VND ะธ NPA) ะฒะผะตััะพ OpenAI vector stores
- โ **BAAI/bge-m3 ัะผะฑะตะดะดะธะฝะณะธ** ัะตัะตะท ะปะพะบะฐะปัะฝัะน ะผะธะบัะพัะตัะฒะธั

## ๐ ะกะพะทะดะฐะฝะฝัะต ัะฐะนะปั

### ะะธะฑะปะธะพัะตะบะธ

1. **`src/lib/alemllm.ts`** - ะะปะธะตะฝั ะดะปั AlemLLM API
   - URL: `<YOUR_ALEMLLM_API_URL>/chat/completions`
   - ะะพะดะตะปั: `astanahub/alemllm`

2. **`src/lib/vector-db.ts`** - ะฃัะธะปะธัั ะดะปั PostgreSQL ะฒะตะบัะพัะฝัั ะะ
   - VND: `<YOUR_DB_HOST>:5433/vnd`
   - NPA: `<YOUR_DB_HOST>:5433/npa`

3. **`src/lib/embedding-client.ts`** - TypeScript ะบะปะธะตะฝั ะดะปั embedding ัะตัะฒะธัะฐ
   - URL: `http://localhost:8001`

4. **`src/lib/embedding-service.py`** - Python ะผะธะบัะพัะตัะฒะธั ะดะปั ะณะตะฝะตัะฐัะธะธ ัะผะฑะตะดะดะธะฝะณะพะฒ
   - ะะพะดะตะปั: BAAI/bge-m3
   - ะะฐะทะผะตัะฝะพััั: 1024

### API Endpoints

5. **`src/app/api/analyze/vnd/route.ts`** - ะะฝะฐะปะธะท ะฟะพ ะะะ
   - ะัะฟะพะปัะทัะตั searchVND() ะดะปั ะฟะพะธัะบะฐ ะฟะพ ะฒะฝัััะตะฝะฝะธะผ ะดะพะบัะผะตะฝัะฐะผ
   - ะะพะฝัะตะบััะฝัะน ะฐะฝะฐะปะธะท ั alemllm

6. **`src/app/api/analyze/np/route.ts`** - ะะฝะฐะปะธะท ะฟะพ ะะะ
   - ะัะฟะพะปัะทัะตั searchNPA() ะดะปั ะณะธะฑัะธะดะฝะพะณะพ ะฟะพะธัะบะฐ (BM25 + Dense + Sparse)
   - ะัะฐะฒะพะฒะพะน ะฐะฝะฐะปะธะท ั alemllm

7. **`src/app/api/analyze/summary/route.ts`** - ะัะพะณะพะฒะพะต ะทะฐะบะปััะตะฝะธะต
   - ะะฑัะตะดะธะฝัะตั ัะตะทัะปััะฐัั ะะะ ะธ ะะะ
   - ะะตะฝะตัะธััะตั ัะตัะตะฝะธะต ะฒะธัััะฐะปัะฝะพะณะพ ะดะธัะตะบัะพัะฐ

## ๐ ะะฐะบ ะทะฐะฟัััะธัั

### 1. ะฃััะฐะฝะพะฒะธัะต ะทะฐะฒะธัะธะผะพััะธ

```bash
# Python ะทะฐะฒะธัะธะผะพััะธ ะดะปั embedding ัะตัะฒะธัะฐ
pip install fastapi uvicorn sentence-transformers torch

# Node.js ะทะฐะฒะธัะธะผะพััะธ (ัะถะต ัััะฐะฝะพะฒะปะตะฝั)
npm install
```

### 2. ะะฐะฟัััะธัะต embedding ัะตัะฒะธั

```bash
# ะ ะพัะดะตะปัะฝะพะผ ัะตัะผะธะฝะฐะปะต
cd /Users/armanaubakirov/cks2/2/sk
python src/lib/embedding-service.py
```

ะกะตัะฒะธั ะทะฐะฟัััะธััั ะฝะฐ `http://localhost:8001`

### 3. ะะฐะฟัััะธัะต Next.js ะฟัะธะปะพะถะตะฝะธะต

```bash
npm run dev
```

ะัะธะปะพะถะตะฝะธะต ะฑัะดะตั ะดะพัััะฟะฝะพ ะฝะฐ `http://localhost:3000`

## ๐งช ะขะตััะธัะพะฒะฐะฝะธะต

### ะัะพะฒะตัะบะฐ health check

```bash
# ะัะพะฒะตัะบะฐ embedding ัะตัะฒะธัะฐ
curl http://localhost:8001/health

# ะัะพะฒะตัะบะฐ AlemLLM API
curl -X POST "<YOUR_ALEMLLM_API_URL>/chat/completions" \
  -H "Content-Type: application/json" \
  -d '{
    "model": "astanahub/alemllm",
    "messages": [{"role": "user", "content": "Test"}]
  }'
```

### ะัะพะฒะตัะบะฐ ะฒะตะบัะพัะฝัั ะฑะฐะท

```bash
# ะะพะดะบะปััะตะฝะธะต ะบ VND ะฑะฐะทะต
psql -h <YOUR_DB_HOST> -p 5433 -U <your-user> -d vnd

# ะ psql:
SELECT COUNT(*) FROM sections;
SELECT COUNT(*) FROM subsections;
\q

# ะะพะดะบะปััะตะฝะธะต ะบ NPA ะฑะฐะทะต
psql -h <YOUR_DB_HOST> -p 5433 -U <your-user> -d npa

# ะ psql:
SELECT COUNT(*) FROM content_chunks;
SELECT COUNT(*) FROM document_metadata;
\q
```

## ๐ ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ         Next.js Frontend (port 3000)        โ
โโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                  โ
                  โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ           API Routes (/api/analyze)         โ
โ  โโ /vnd    - ะะะ ะฐะฝะฐะปะธะท                    โ
โ  โโ /np     - ะะะ ะฐะฝะฐะปะธะท                    โ
โ  โโ /summary- ะัะพะณะพะฒะพะต ะทะฐะบะปััะตะฝะธะต           โ
โโโโโโโฌโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโฌโโโโโโโโโโ
      โ              โ              โ
      โผ              โผ              โผ
โโโโโโโโโโโโ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ
โ AlemLLM  โ  โ  Embedding  โ  โ  PostgreSQL  โ
โ   API    โ  โ   Service   โ  โ  Vector DBs  โ
โ (remote) โ  โ (local:8001)โ  โ   (remote)   โ
โโโโโโโโโโโโ  โโโโโโโโโโโโโโโ  โโโโโโโโโโโโโโโโ
```

## ๐ง ะะพะฝัะธะณััะฐัะธั

### ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั (ะพะฟัะธะพะฝะฐะปัะฝะพ)

ะกะพะทะดะฐะนัะต ัะฐะนะป `.env.local`:

```bash
# Embedding Service
EMBEDDING_SERVICE_URL=http://localhost:8001

# PostgreSQL (ัะถะต ะฒ ะบะพะดะต, ะฝะพ ะผะพะถะฝะพ ะฒัะฝะตััะธ)
VND_DB_HOST=<YOUR_DB_HOST>
VND_DB_PORT=5433
VND_DB_NAME=vnd
VND_DB_USER=postgres
VND_DB_PASSWORD=<YOUR_DB_PASSWORD>

NPA_DB_HOST=<YOUR_DB_HOST>
NPA_DB_PORT=5433
NPA_DB_NAME=npa
NPA_DB_USER=postgres
NPA_DB_PASSWORD=<YOUR_DB_PASSWORD>

# AlemLLM API (ัะถะต ะฒ ะบะพะดะต)
ALEMLLM_API_URL=<YOUR_ALEMLLM_API_URL>
```

## ๐ ะะพะทะผะพะถะฝัะต ะฟัะพะฑะปะตะผั ะธ ัะตัะตะฝะธั

### 1. Embedding ัะตัะฒะธั ะฝะตะดะพัััะฟะตะฝ

**ะัะธะฑะบะฐ:** "ะกะตัะฒะธั ัะผะฑะตะดะดะธะฝะณะพะฒ ะฝะตะดะพัััะฟะตะฝ"

**ะะตัะตะฝะธะต:**
```bash
python src/lib/embedding-service.py
```

### 2. ะัะธะฑะบะฐ ะฟะพะดะบะปััะตะฝะธั ะบ PostgreSQL

**ะัะธะฑะบะฐ:** "ะัะธะฑะบะฐ ะะ ะะะ/ะะะ"

**ะัะพะฒะตัะบะฐ:**
```bash
telnet <YOUR_DB_HOST> 5433
```

**ะะพะทะผะพะถะฝัะต ะฟัะธัะธะฝั:**
- ะกะตัะฒะตั ะฝะตะดะพัััะฟะตะฝ
- ะะตะฟัะฐะฒะธะปัะฝัะต credentials
- Firewall ะฑะปะพะบะธััะตั ะฟะพัั

### 3. AlemLLM API ะฝะตะดะพัััะฟะตะฝ

**ะัะธะฑะบะฐ:** "ะัะธะฑะบะฐ AlemLLM"

**ะัะพะฒะตัะบะฐ:**
```bash
curl <YOUR_ALEMLLM_API_URL>/health
```

### 4. ะะพะดะตะปั BAAI/bge-m3 ะฝะต ะทะฐะณััะถะตะฝะฐ

**ะัะธะฑะบะฐ ะฟัะธ ััะฐััะต embedding ัะตัะฒะธัะฐ**

**ะะตัะตะฝะธะต:**
```bash
# ะะพะดะตะปั ะทะฐะณััะทะธััั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟัะธ ะฟะตัะฒะพะผ ะทะฐะฟััะบะต
# ะขัะตะฑัะตััั ~2GB ัะฒะพะฑะพะดะฝะพะณะพ ะผะตััะฐ
python -c "from sentence_transformers import SentenceTransformer; SentenceTransformer('BAAI/bge-m3')"
```

## ๐ ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั

### ะัะตะผั ะพัะฒะตัะฐ (ะฟัะธะผะตัะฝะพะต)

- **ะะตะฝะตัะฐัะธั ัะผะฑะตะดะดะธะฝะณะพะฒ:** 100-500ms (ะทะฐะฒะธัะธั ะพั ะดะปะธะฝั ัะตะบััะฐ)
- **ะะพะธัะบ ะฒ ะฒะตะบัะพัะฝะพะน ะะ:** 10-50ms
- **AlemLLM ะณะตะฝะตัะฐัะธั:** 5-30 ัะตะบัะฝะด (ะทะฐะฒะธัะธั ะพั ะดะปะธะฝั ะพัะฒะตัะฐ)
- **ะะพะปะฝัะน ะฐะฝะฐะปะธะท (3 ััะฐะฟะฐ):** 20-90 ัะตะบัะฝะด

### ะะฟัะธะผะธะทะฐัะธั

1. **ะััะธัะพะฒะฐะฝะธะต ัะผะฑะตะดะดะธะฝะณะพะฒ** - ะผะพะถะฝะพ ะดะพะฑะฐะฒะธัั Redis
2. **Batch ะพะฑัะฐะฑะพัะบะฐ** - ะพะฑัะตะดะธะฝััั ะทะฐะฟัะพัั ะบ embedding ัะตัะฒะธัั
3. **Connection pooling** - ัะถะต ัะตะฐะปะธะทะพะฒะฐะฝ ะฒ `vector-db.ts`

## ๐ ะะพะบัะผะตะฝัะฐัะธั

### ะะพะปะตะทะฝัะต ัััะปะบะธ

- [AlemLLM API docs](<YOUR_ALEMLLM_BASE_URL>/docs)
- [BAAI/bge-m3 model](https://huggingface.co/BAAI/bge-m3)
- [pgvecto.rs docs](https://docs.pgvecto.rs/)
- [PostgreSQL vector databases README](./docs/README.md)

### ะกัััะบัััะฐ ะฟัะพะผะฟัะพะฒ

ะัะต ะฟัะพะผะฟัั ะพะฟัะธะผะธะทะธัะพะฒะฐะฝั ะดะปั ะฟะพะปััะตะฝะธั ััััะบัััะธัะพะฒะฐะฝะฝัั ะพัะฒะตัะพะฒ:

- **ะะะ ะฐะฝะฐะปะธะท:** ะคะพะบัั ะฝะฐ ะฒะฝัััะตะฝะฝะธะต ััะฐะฝะดะฐััั ะบะพะผะฟะฐะฝะธะธ
- **ะะะ ะฐะฝะฐะปะธะท:** ะคะพะบัั ะฝะฐ ะทะฐะบะพะฝะพะดะฐัะตะปัััะฒะพ ะะ
- **Summary:** ะะฑัะตะดะธะฝะตะฝะธะต + ัะตัะตะฝะธะต ะฒะธัััะฐะปัะฝะพะณะพ ะดะธัะตะบัะพัะฐ

## โ Checklist ะผะธะณัะฐัะธะธ

- [x] ะกะพะทะดะฐะฝ AlemLLM ะบะปะธะตะฝั
- [x] ะกะพะทะดะฐะฝั ััะธะปะธัั ะดะปั PostgreSQL
- [x] ะกะพะทะดะฐะฝ embedding ะผะธะบัะพัะตัะฒะธั
- [x] ะะฑะฝะพะฒะปะตะฝ VND endpoint
- [x] ะะฑะฝะพะฒะปะตะฝ NPA endpoint  
- [x] ะะฑะฝะพะฒะปะตะฝ Summary endpoint
- [ ] ะัะพัะตััะธัะพะฒะฐะฝ ะฟะพะปะฝัะน flow
- [ ] ะะพะฑะฐะฒะปะตะฝ ะผะพะฝะธัะพัะธะฝะณ ะพัะธะฑะพะบ
- [ ] ะะฐัััะพะตะฝะพ ะปะพะณะธัะพะฒะฐะฝะธะต

## ๐ฏ ะกะปะตะดัััะธะต ัะฐะณะธ

1. **ะขะตััะธัะพะฒะฐะฝะธะต** - ะฟัะพัะตััะธัะพะฒะฐัั ะฒัะต ััะธ ััะฐะฟะฐ ะฐะฝะฐะปะธะทะฐ
2. **ะะพะฝะธัะพัะธะฝะณ** - ะดะพะฑะฐะฒะธัั ะปะพะณะธัะพะฒะฐะฝะธะต ะทะฐะฟัะพัะพะฒ
3. **ะะฟัะธะผะธะทะฐัะธั** - ะดะพะฑะฐะฒะธัั ะบััะธัะพะฒะฐะฝะธะต, ะตัะปะธ ะฝัะถะฝะพ
4. **ะะพะบัะผะตะฝัะฐัะธั** - ะพะฑะฝะพะฒะธัั ะฟะพะปัะทะพะฒะฐัะตะปััะบัั ะดะพะบัะผะตะฝัะฐัะธั

---

**ะกะพะทะดะฐะฝะพ:** 5 ัะฝะฒะฐัั 2025  
**ะะตััะธั:** 1.0  
**ะกัะฐััั:** โ ะะพัะพะฒะพ ะบ ัะตััะธัะพะฒะฐะฝะธั
