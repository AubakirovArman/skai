/**
 * –¢–µ—Å—Ç —É—Ç–∏–ª–∏—Ç—ã text-sanitizer
 * –ó–∞–ø—É—Å–∫: node test-text-sanitizer.js
 */

// –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é (–≤ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ TypeScript)
function sanitizeTextForTTS(text) {
  if (!text) return ''

  let cleaned = text

  // 1. –£–¥–∞–ª—è–µ–º Markdown –∑–∞–≥–æ–ª–æ–≤–∫–∏
  cleaned = cleaned.replace(/^#{1,6}\s+/gm, '')

  // 2. –£–¥–∞–ª—è–µ–º –∂–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç –∏ –∫—É—Ä—Å–∏–≤
  cleaned = cleaned.replace(/\*\*(.+?)\*\*/g, '$1')
  cleaned = cleaned.replace(/__(.+?)__/g, '$1')
  cleaned = cleaned.replace(/\*(.+?)\*/g, '$1')
  cleaned = cleaned.replace(/_(.+?)_/g, '$1')

  // 3. –£–¥–∞–ª—è–µ–º –∑–∞—á—ë—Ä–∫–Ω—É—Ç—ã–π —Ç–µ–∫—Å—Ç
  cleaned = cleaned.replace(/~~(.+?)~~/g, '$1')

  // 4. –£–¥–∞–ª—è–µ–º —Å—Å—ã–ª–∫–∏
  cleaned = cleaned.replace(/\[([^\]]+)\]\([^)]+\)/g, '$1')

  // 5. –£–¥–∞–ª—è–µ–º –º–∞—Ä–∫–µ—Ä—ã —Å–ø–∏—Å–∫–æ–≤
  cleaned = cleaned.replace(/^[\s]*[-*+]\s+/gm, '')

  // 6. –£–¥–∞–ª—è–µ–º –Ω—É–º–µ—Ä–∞—Ü–∏—é —Å–ø–∏—Å–∫–æ–≤
  cleaned = cleaned.replace(/^[\s]*\d+\.\s+/gm, '')

  // 7. –£–¥–∞–ª—è–µ–º –±–ª–æ–∫–∏ —Ü–∏—Ç–∞—Ç
  cleaned = cleaned.replace(/^>\s+/gm, '')

  // 8. –£–¥–∞–ª—è–µ–º –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ –ª–∏–Ω–∏–∏
  cleaned = cleaned.replace(/^[\s]*[-*_]{3,}[\s]*$/gm, '')

  // 9. –£–¥–∞–ª—è–µ–º inline code
  cleaned = cleaned.replace(/`([^`]+)`/g, '$1')

  // 10. –£–¥–∞–ª—è–µ–º –±–ª–æ–∫–∏ –∫–æ–¥–∞
  cleaned = cleaned.replace(/```[\s\S]*?```/g, '')

  // 11. –ó–∞–º–µ–Ω—è–µ–º –¥–≤–æ–µ—Ç–æ—á–∏–µ —Å –ø—Ä–æ–±–µ–ª–æ–º
  cleaned = cleaned.replace(/:\s+/g, ': ')

  // 12. –£–¥–∞–ª—è–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–µ–ª—ã
  cleaned = cleaned.replace(/\s{2,}/g, ' ')

  // 13. –£–¥–∞–ª—è–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫
  cleaned = cleaned.replace(/\n{3,}/g, '\n\n')

  // 14. –ó–∞–º–µ–Ω—è–µ–º –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫ –Ω–∞ —Ç–æ—á–∫—É —Å –ø—Ä–æ–±–µ–ª–æ–º
  cleaned = cleaned.replace(/\n+/g, '. ')

  // 15. –£–¥–∞–ª—è–µ–º –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ç–æ—á–∫–∏
  cleaned = cleaned.replace(/\.{2,}/g, '.')

  // 16. –£–¥–∞–ª—è–µ–º —Ç–æ—á–∫—É –ø–µ—Ä–µ–¥ –∑–∞–ø—è—Ç–æ–π
  cleaned = cleaned.replace(/\.\s*([,;.])/g, '$1')

  // 17. –£–±–∏—Ä–∞–µ–º –ø—Ä–æ–±–µ–ª—ã –ø–µ—Ä–µ–¥ –∑–Ω–∞–∫–∞–º–∏ –ø—Ä–µ–ø–∏–Ω–∞–Ω–∏—è
  cleaned = cleaned.replace(/\s+([.,;:!?])/g, '$1')

  // 18. –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–æ–±–µ–ª –ø–æ—Å–ª–µ –∑–Ω–∞–∫–æ–≤ –ø—Ä–µ–ø–∏–Ω–∞–Ω–∏—è
  cleaned = cleaned.replace(/([.,;:!?])([^\s\d])/g, '$1 $2')

  // 19. –£–±–∏—Ä–∞–µ–º –ø—Ä–æ–±–µ–ª—ã –≤ –Ω–∞—á–∞–ª–µ –∏ –∫–æ–Ω—Ü–µ
  cleaned = cleaned.trim()

  // 20. –£–¥–∞–ª—è–µ–º –¥–≤–æ–π–Ω—ã–µ –ø—Ä–æ–±–µ–ª—ã
  cleaned = cleaned.replace(/\s{2,}/g, ' ')

  return cleaned
}

// –¢–µ—Å—Ç—ã
console.log('üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ text-sanitizer\n')

// –¢–µ—Å—Ç 1: –ñ–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç
const test1 = '**–ü–£–ù–ö–¢ –ü–û–í–ï–°–¢–ö–ò –î–ù–Ø:** –£—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π'
console.log('–¢–µ—Å—Ç 1: –ñ–∏—Ä–Ω—ã–π —Ç–µ–∫—Å—Ç')
console.log('–í—Ö–æ–¥:', test1)
console.log('–í—ã—Ö–æ–¥:', sanitizeTextForTTS(test1))
console.log('–û–∂–∏–¥–∞–µ—Ç—Å—è: –ü–£–ù–ö–¢ –ü–û–í–ï–°–¢–ö–ò –î–ù–Ø: –£—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π')
console.log('')

// –¢–µ—Å—Ç 2: –ó–∞–≥–æ–ª–æ–≤–∫–∏
const test2 = '### –ö—Ä–∞—Ç–∫–æ–µ –∑–∞–∫–ª—é—á–µ–Ω–∏–µ\n\n**–¢–µ–∫—Å—Ç**'
console.log('–¢–µ—Å—Ç 2: –ó–∞–≥–æ–ª–æ–≤–∫–∏')
console.log('–í—Ö–æ–¥:', test2)
console.log('–í—ã—Ö–æ–¥:', sanitizeTextForTTS(test2))
console.log('–û–∂–∏–¥–∞–µ—Ç—Å—è: –ö—Ä–∞—Ç–∫–æ–µ –∑–∞–∫–ª—é—á–µ–Ω–∏–µ. –¢–µ–∫—Å—Ç')
console.log('')

// –¢–µ—Å—Ç 3: –°–ø–∏—Å–∫–∏
const test3 = '**–†–∏—Å–∫–∏:**\n\n- –†–∏—Å–∫ 1\n- –†–∏—Å–∫ 2\n- –†–∏—Å–∫ 3'
console.log('–¢–µ—Å—Ç 3: –°–ø–∏—Å–∫–∏')
console.log('–í—Ö–æ–¥:', test3)
console.log('–í—ã—Ö–æ–¥:', sanitizeTextForTTS(test3))
console.log('–û–∂–∏–¥–∞–µ—Ç—Å—è: –†–∏—Å–∫–∏: –†–∏—Å–∫ 1. –†–∏—Å–∫ 2. –†–∏—Å–∫ 3')
console.log('')

// –¢–µ—Å—Ç 4: –°—Å—ã–ª–∫–∏
const test4 = '–î–æ–∫—É–º–µ–Ω—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ [—Å—Å—ã–ª–∫–µ](https://example.com).'
console.log('–¢–µ—Å—Ç 4: –°—Å—ã–ª–∫–∏')
console.log('–í—Ö–æ–¥:', test4)
console.log('–í—ã—Ö–æ–¥:', sanitizeTextForTTS(test4))
console.log('–û–∂–∏–¥–∞–µ—Ç—Å—è: –î–æ–∫—É–º–µ–Ω—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ —Å—Å—ã–ª–∫–µ.')
console.log('')

// –¢–µ—Å—Ç 5: –ê–Ω–≥–ª–∏–π—Å–∫–∏–π —Ç–µ–∫—Å—Ç
const test5 = '**AGENDA ITEM:** Adjustments\n\n**DECISION:** FOR'
console.log('–¢–µ—Å—Ç 5: –ê–Ω–≥–ª–∏–π—Å–∫–∏–π —Ç–µ–∫—Å—Ç')
console.log('–í—Ö–æ–¥:', test5)
console.log('–í—ã—Ö–æ–¥:', sanitizeTextForTTS(test5))
console.log('–û–∂–∏–¥–∞–µ—Ç—Å—è: AGENDA ITEM: Adjustments. DECISION: FOR')
console.log('')

// –¢–µ—Å—Ç 6: –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π
const test6 = `### –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–ü–£–ù–ö–¢ –ü–û–í–ï–°–¢–ö–ò –î–ù–Ø:** –£—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π

**–ì–û–õ–û–°–£–Æ:** –ó–ê

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**

- –ü—É–Ω–∫—Ç 1
- –ü—É–Ω–∫—Ç 2

–°—Å—ã–ª–∫–∞ –Ω–∞ [–¥–æ–∫—É–º–µ–Ω—Ç](https://example.com).`

console.log('–¢–µ—Å—Ç 6: –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π')
console.log('–í—Ö–æ–¥:\n' + test6)
console.log('')
console.log('–í—ã—Ö–æ–¥:', sanitizeTextForTTS(test6))
console.log('')
console.log('‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã!')
