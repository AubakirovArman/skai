# AlemLLM + PostgreSQL Vector DB Integration

## ๐ ะะฝััััะบัะธั ะฟะพ ะทะฐะฟััะบั

### 1. ะะฐะฟััะบ Embedding Service (Python)

Embedding service ะฝะตะพะฑัะพะดะธะผ ะดะปั ะณะตะฝะตัะฐัะธะธ ะฒะตะบัะพัะพะฒ ะธะท ัะตะบััะฐ.

```bash
# ะฃััะฐะฝะพะฒะธัะต ะทะฐะฒะธัะธะผะพััะธ (ะตัะปะธ ะตัะต ะฝะต ัััะฐะฝะพะฒะปะตะฝั)
pip install fastapi uvicorn sentence-transformers torch

# ะะฐะฟัััะธัะต ัะตัะฒะธั
python src/lib/embedding-service.py
```

ะกะตัะฒะธั ะฑัะดะตั ะดะพัััะฟะตะฝ ะฝะฐ `http://localhost:8001`

### 2. ะะฐะฟััะบ Next.js ะฟัะธะปะพะถะตะฝะธั

```bash
# ะฃััะฐะฝะพะฒะธัะต ะทะฐะฒะธัะธะผะพััะธ
npm install

# ะะฐะฟัััะธัะต ะฒ ัะตะถะธะผะต ัะฐะทัะฐะฑะพัะบะธ
npm run dev
```

ะัะธะปะพะถะตะฝะธะต ะฑัะดะตั ะดะพัััะฟะฝะพ ะฝะฐ `http://localhost:3000`

## ๐งช ะขะตััะธัะพะฒะฐะฝะธะต API

### ะขะตัั 1: ะะะ ะะฝะฐะปะธะท

```bash
curl -X POST http://localhost:3000/api/analyze/vnd \
  -H "Content-Type: application/json" \
  -d '{
    "documentContent": "ะกะพะฒะตั ะดะธัะตะบัะพัะพะฒ ะะ ะกะฐะผััะบ-ะะฐะทัะฝะฐ ัะฐััะผะฐััะธะฒะฐะตั ะฒะพะฟัะพั ะพะฑ ััะฒะตัะถะดะตะฝะธะธ ัะดะตะปะบะธ ะฝะฐ ััะผะผั 5 ะผะปะฝ ัะตะฝะณะต. ะะพะบัะผะตะฝั ัะพะดะตัะถะธั ัะธะฝะฐะฝัะพะฒะพะต ะพะฑะพัะฝะพะฒะฐะฝะธะต ะธ ัะพะณะปะฐัะพะฒะฐะฝะธั ะดะตะฟะฐััะฐะผะตะฝัะพะฒ."
  }'
```

### ะขะตัั 2: ะะะ ะะฝะฐะปะธะท

```bash
curl -X POST http://localhost:3000/api/analyze/np \
  -H "Content-Type: application/json" \
  -d '{
    "documentContent": "ะขะะ ะฟะปะฐะฝะธััะตั ะทะฐะบะปััะธัั ะดะพะณะพะฒะพั ะฟะพััะฐะฒะบะธ ะพะฑะพััะดะพะฒะฐะฝะธั ั ะทะฐััะฑะตะถะฝะพะน ะบะพะผะฟะฐะฝะธะตะน ะฝะฐ ััะผะผั 10 ะผะปะฝ ัะตะฝะณะต."
  }'
```

### ะขะตัั 3: ะัะพะณะพะฒะพะต ะะฐะบะปััะตะฝะธะต

```bash
curl -X POST http://localhost:3000/api/analyze/summary \
  -H "Content-Type: application/json" \
  -d '{
    "vndResult": "ะะะ: ะะพะบัะผะตะฝั ัะพะพัะฒะตัััะฒัะตั ะฃััะฐะฒั...",
    "npResult": "ะะะ: ะกะดะตะปะบะฐ ะฝะต ะฟัะพัะธะฒะพัะตัะธั ะทะฐะบะพะฝะพะดะฐัะตะปัััะฒั..."
  }'
```

## ๐ ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ          Next.js Application                โ
โ         (http://localhost:3000)             โ
โโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                  โ
        โโโโโโโโโโโดโโโโโโโโโโ
        โ                   โ
        โผ                   โผ
โโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโ
โ  AlemLLM API โ    โ  Embedding   โ
โ  (alemllm.   โ    โ   Service    โ
โ   sk-ai.kz)  โ    โ (localhost:  โ
โ              โ    โ     8001)    โ
โโโโโโโโโโโโโโโโ    โโโโโโโโฌโโโโโโโโ
                           โ
                           โผ
                  โโโโโโโโโโโโโโโโโโโ
                  โ   PostgreSQL    โ
                  โ   Vector DBs    โ
                  โ  <YOUR_DB_HOST> โ
                  โ     :5433       โ
                  โ                 โ
                  โ  โโ vnd (ะะะ)  โ
                  โ  โโ npa (ะะะ)  โ
                  โโโโโโโโโโโโโโโโโโโ
```

## ๐ง ะะฐัััะพะนะบะฐ ะฟะตัะตะผะตะฝะฝัั ะพะบััะถะตะฝะธั

ะกะพะทะดะฐะนัะต ัะฐะนะป `.env.local`:

```bash
# Embedding Service
EMBEDDING_SERVICE_URL=http://localhost:8001

# PostgreSQL (ัะถะต ะฝะฐัััะพะตะฝั ะฒ ะบะพะดะต)
# VND_DB_DSN=postgresql://<user>:***@<YOUR_DB_HOST>:5433/vnd
# NPA_DB_DSN=postgresql://<user>:***@<YOUR_DB_HOST>:5433/npa

# AlemLLM API (ัะถะต ะฝะฐัััะพะตะฝั ะฒ ะบะพะดะต)
# ALEMLLM_API_URL=<YOUR_ALEMLLM_API_URL>
```

## ๐ ะะพะณะธ ะธ ะพัะปะฐะดะบะฐ

### ะัะพะฒะตัะบะฐ Embedding Service:

```bash
curl http://localhost:8001/health
```

ะัะฒะตั ะดะพะปะถะตะฝ ะฑััั:
```json
{
  "status": "healthy",
  "model": "BAAI/bge-m3",
  "device": "cpu/cuda/mps",
  "dimension": 1024
}
```

### ะัะพะฒะตัะบะฐ AlemLLM API:

```bash
curl -X POST "<YOUR_ALEMLLM_API_URL>/chat/completions" \
  -H "Content-Type: application/json" \
  -d '{
    "model": "astanahub/alemllm",
    "messages": [
      {"role": "user", "content": "ะัะธะฒะตั"}
    ]
  }'
```

### ะัะพะฒะตัะบะฐ PostgreSQL:

```bash
psql -h <YOUR_DB_HOST> -p 5433 -U <your-user> -d vnd -c "SELECT COUNT(*) FROM sections;"
```

## โ๏ธ ะะพะทะผะพะถะฝัะต ะพัะธะฑะบะธ

### 1. "ะกะตัะฒะธั ัะผะฑะตะดะดะธะฝะณะพะฒ ะฝะตะดะพัััะฟะตะฝ"

**ะะตัะตะฝะธะต:** ะฃะฑะตะดะธัะตัั, ััะพ embedding-service ะทะฐะฟััะตะฝ:
```bash
python src/lib/embedding-service.py
```

### 2. "ะัะธะฑะบะฐ ะะ ะะะ/ะะะ"

**ะะตัะตะฝะธะต:** ะัะพะฒะตัััะต ะดะพัััะฟะฝะพััั PostgreSQL ัะตัะฒะตัะฐ:
```bash
telnet <YOUR_DB_HOST> 5433
```

### 3. "ะัะธะฑะบะฐ AlemLLM"

**ะะตัะตะฝะธะต:** ะัะพะฒะตัััะต ะดะพัััะฟะฝะพััั AlemLLM API:
```bash
curl <YOUR_ALEMLLM_API_URL>/chat/completions
```

### 4. Module not found: Can't resolve 'pg'

**ะะตัะตะฝะธะต:** ะฃััะฐะฝะพะฒะธัะต ะทะฐะฒะธัะธะผะพััะธ:
```bash
npm install pg @types/pg
```

## ๐ฆ ะะฐะฒะธัะธะผะพััะธ

### Python (ะดะปั embedding-service.py):
```bash
pip install fastapi uvicorn sentence-transformers torch
```

### Node.js:
```bash
npm install pg @types/pg
```

## ๐ฏ ะะตะทัะปััะฐัั ัะตััะธัะพะฒะฐะฝะธั

ะะพัะปะต ะทะฐะฟััะบะฐ ะฟัะพะฒะตัััะต:
- โ Embedding service ัะฐะฑะพัะฐะตั (http://localhost:8001/health)
- โ Next.js ะทะฐะฟััะตะฝ (http://localhost:3000)
- โ API ะะะ ะฒะพะทะฒัะฐัะฐะตั ะฐะฝะฐะปะธะท
- โ API ะะะ ะฒะพะทะฒัะฐัะฐะตั ะฐะฝะฐะปะธะท
- โ API Summary ัะพัะผะธััะตั ะทะฐะบะปััะตะฝะธะต

## ๐ ะะพะดะดะตัะถะบะฐ

ะัะธ ะฒะพะทะฝะธะบะฝะพะฒะตะฝะธะธ ะฟัะพะฑะปะตะผ ะฟัะพะฒะตัััะต:
1. ะะพะณะธ embedding-service
2. ะะพะณะธ Next.js (npm run dev)
3. Network tab ะฒ ะฑัะฐัะทะตัะต
4. ะะพะฝัะพะปั ะฑัะฐัะทะตัะฐ (F12)
