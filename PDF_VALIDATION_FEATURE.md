# üìÑ PDF Validation Feature with QR Code

## –û–ø–∏—Å–∞–Ω–∏–µ

–î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å "–í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å" - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è PDF –¥–æ–∫—É–º–µ–Ω—Ç–∞ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –∞–Ω–∞–ª–∏–∑–∞ –∏ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–º QR-–∫–æ–¥–æ–º –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è.

---

## üéØ –ß—Ç–æ –¥–µ–ª–∞–µ—Ç –∫–Ω–æ–ø–∫–∞ "–í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å"

1. **–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç PDF –¥–æ–∫—É–º–µ–Ω—Ç** —Å –ø–æ–ª–Ω—ã–º–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –∞–Ω–∞–ª–∏–∑–∞:
   - –ò—Ç–æ–≥–æ–≤–æ–µ –∑–∞–∫–ª—é—á–µ–Ω–∏–µ (Summary)
   - –ê–Ω–∞–ª–∏–∑ –í–ù–î (–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã)
   - –ê–Ω–∞–ª–∏–∑ –ù–ü–ê (–ù–æ—Ä–º–∞—Ç–∏–≤–Ω–æ-–ø—Ä–∞–≤–æ–≤—ã–µ –∞–∫—Ç—ã)

2. **–°–æ–∑–¥–∞—ë—Ç QR-–∫–æ–¥** –≤–Ω—É—Ç—Ä–∏ PDF:
   - QR-–∫–æ–¥ —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Å—ã–ª–∫—É –Ω–∞ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —ç—Ç–æ–≥–æ –∂–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞
   - –†–∞–∑–º–µ—â–∞–µ—Ç—Å—è –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
   - –í–∫–ª—é—á–∞–µ—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –Ω–∞ 3 —è–∑—ã–∫–∞—Ö (ru/kk/en)

3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫–∞—á–∏–≤–∞–µ—Ç** PDF –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
npm install jspdf qrcode @types/qrcode
```

- **jsPDF** - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è PDF –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
- **qrcode** - —Å–æ–∑–¥–∞–Ω–∏–µ QR-–∫–æ–¥–æ–≤
- **@types/qrcode** - TypeScript —Ç–∏–ø—ã

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### 1. API Routes

#### `/api/export-pdf` (POST)
–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç PDF —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –∞–Ω–∞–ª–∏–∑–∞ –∏ QR-–∫–æ–¥–æ–º.

**Request:**
```typescript
{
  vnd: string          // –¢–µ–∫—Å—Ç –∞–Ω–∞–ª–∏–∑–∞ –í–ù–î
  np: string           // –¢–µ–∫—Å—Ç –∞–Ω–∞–ª–∏–∑–∞ –ù–ü–ê
  summary: string      // –ò—Ç–æ–≥–æ–≤–æ–µ –∑–∞–∫–ª—é—á–µ–Ω–∏–µ
  fileName?: string    // –ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–∞
  language?: 'ru' | 'kk' | 'en'  // –Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
}
```

**Response:**
```typescript
{
  success: true
  pdfId: string           // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID PDF
  downloadUrl: string     // URL –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
  qrCodeUrl: string       // Data URL QR-–∫–æ–¥–∞
  size: number            // –†–∞–∑–º–µ—Ä PDF –≤ –±–∞–π—Ç–∞—Ö
}
```

#### `/api/download-pdf/[id]` (GET)
–°–∫–∞—á–∏–≤–∞–µ—Ç PDF –ø–æ ID.

**Response:** PDF —Ñ–∞–π–ª (`application/pdf`)

---

### 2. Frontend Integration

#### –ö–Ω–æ–ø–∫–∞ –≤ UI (`src/app/virtual-director/page.tsx`)

```tsx
<button
  onClick={handleValidate}
  disabled={isValidating}
  className="rounded-xl border border-[#d7a13a]/50 bg-gradient-to-r from-[#d7a13a] to-[#c89030] px-4 py-2 text-sm font-medium text-white transition hover:from-[#c89030] hover:to-[#b98028] disabled:opacity-50 disabled:cursor-not-allowed shadow-sm"
>
  {isValidating ? t.results.validating : t.results.validate}
</button>
```

**–°–æ—Å—Ç–æ—è–Ω–∏—è:**
- `isValidating: false` ‚Üí "üìÑ –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å"
- `isValidating: true` ‚Üí "–ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF..."

#### –û–±—Ä–∞–±–æ—Ç—á–∏–∫ `handleValidate()`

```typescript
const handleValidate = async () => {
  if (!analysisResult) return

  setIsValidating(true)
  
  try {
    // 1. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º PDF —á–µ—Ä–µ–∑ API
    const response = await fetch('/api/export-pdf', {
      method: 'POST',
      body: JSON.stringify({
        vnd: analysisResult.vnd,
        np: analysisResult.np,
        summary: analysisResult.summary,
        fileName: analysisResult.fileName || 'document',
        language: analysisResult.language || language,
      }),
    })

    const data = await response.json()
    
    // 2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–∫–∞—á–∏–≤–∞–µ–º PDF
    const downloadLink = document.createElement('a')
    downloadLink.href = data.downloadUrl
    downloadLink.download = `analysis-${data.pdfId}.pdf`
    downloadLink.click()

    // 3. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    alert('‚úÖ PDF –¥–æ–∫—É–º–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!')
  } catch (error) {
    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ PDF –¥–æ–∫—É–º–µ–Ω—Ç–∞.')
  } finally {
    setIsValidating(false)
  }
}
```

---

## üåç –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è

–î–æ–±–∞–≤–ª–µ–Ω—ã –ø–µ—Ä–µ–≤–æ–¥—ã –≤ `src/locales/virtual-director.ts`:

```typescript
// –†—É—Å—Å–∫–∏–π
results: {
  validate: "üìÑ –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å",
  validating: "–ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF...",
}

// –ö–∞–∑–∞—Ö—Å–∫–∏–π
results: {
  validate: "üìÑ –†–∞—Å—Ç–∞—É",
  validating: "PDF –≥–µ–Ω–µ—Ä–∞—Ü–∏—è—Å—ã...",
}

// English
results: {
  validate: "üìÑ Validate",
  validating: "Generating PDF...",
}
```

---

## üìÑ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ PDF

### –°—Ç—Ä–∞–Ω–∏—Ü–∞ 1-N: –ö–æ–Ω—Ç–µ–Ω—Ç –∞–Ω–∞–ª–∏–∑–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞        ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ –î–∞—Ç–∞: 07.10.2025, 18:30            ‚îÇ
‚îÇ –§–∞–π–ª: document.docx                 ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ üìã –ö—Ä–∞—Ç–∫–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ               ‚îÇ
‚îÇ [–¢–µ–∫—Å—Ç –∏—Ç–æ–≥–æ–≤–æ–≥–æ –∑–∞–∫–ª—é—á–µ–Ω–∏—è...]     ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ üìö –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –Ω–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã ‚îÇ
‚îÇ [–¢–µ–∫—Å—Ç –∞–Ω–∞–ª–∏–∑–∞ –í–ù–î...]              ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ ‚öñÔ∏è –ù–æ—Ä–º–∞—Ç–∏–≤–Ω–æ-–ø—Ä–∞–≤–æ–≤—ã–µ –∞–∫—Ç—ã         ‚îÇ
‚îÇ [–¢–µ–∫—Å—Ç –∞–Ω–∞–ª–∏–∑–∞ –ù–ü–ê...]              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ü–æ—Å–ª–µ–¥–Ω—è—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞: QR-–∫–æ–¥

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                                     ‚îÇ
‚îÇ    üì≤ QR-–∫–æ–¥ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è         ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê             ‚îÇ
‚îÇ         ‚îÇ ‚ñì‚ñì‚ñì‚ñë‚ñì‚ñë‚ñë‚ñì‚ñì‚ñì ‚îÇ             ‚îÇ
‚îÇ         ‚îÇ ‚ñë‚ñë‚ñì‚ñì‚ñë‚ñì‚ñì‚ñì‚ñë‚ñë ‚îÇ  [QR-–∫–æ–¥]  ‚îÇ
‚îÇ         ‚îÇ ‚ñì‚ñë‚ñì‚ñë‚ñì‚ñë‚ñì‚ñì‚ñì‚ñë ‚îÇ             ‚îÇ
‚îÇ         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò             ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ  –û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥ –¥–ª—è            ‚îÇ
‚îÇ  —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —ç—Ç–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞         ‚îÇ
‚îÇ                                     ‚îÇ
‚îÇ  https://...com/api/download/abc123 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –•—Ä–∞–Ω–µ–Ω–∏–µ PDF
- PDF —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ (`Map<string, Buffer>`)
- –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ `crypto.randomBytes(16)`
- –°—Ä–æ–∫ –∂–∏–∑–Ω–∏: –¥–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω–∞
```typescript
// –í–º–µ—Å—Ç–æ Map –≤ –ø–∞–º—è—Ç–∏:

// 1. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É
import { writeFile } from 'fs/promises'
await writeFile(`/tmp/pdfs/${pdfId}.pdf`, pdfBuffer)

// 2. –ó–∞–≥—Ä—É–∑–∫–∞ –≤ S3
import { S3 } from 'aws-sdk'
await s3.putObject({
  Bucket: 'my-pdfs',
  Key: `${pdfId}.pdf`,
  Body: pdfBuffer
})

// 3. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (PostgreSQL + BYTEA)
await db.query(
  'INSERT INTO pdfs (id, data) VALUES ($1, $2)',
  [pdfId, pdfBuffer]
)
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –®–∞–≥ 1: –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
```bash
npm run dev
```

#### –®–∞–≥ 2: –í—ã–ø–æ–ª–Ω–∏—Ç—å –∞–Ω–∞–ª–∏–∑
1. –û—Ç–∫—Ä—ã—Ç—å http://localhost:3000/virtual-director
2. –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç
3. –ù–∞–∂–∞—Ç—å "–ù–∞—á–∞—Ç—å –∞–Ω–∞–ª–∏–∑"
4. –î–æ–∂–¥–∞—Ç—å—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (–≤–∫–ª—é—á–∞—è –∞—É–¥–∏–æ)

#### –®–∞–≥ 3: –ù–∞–∂–∞—Ç—å "–í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å"
1. –ö–Ω–æ–ø–∫–∞ –¥–æ–ª–∂–Ω–∞ –∏–∑–º–µ–Ω–∏—Ç—Å—è –Ω–∞ "–ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF..."
2. –ß–µ—Ä–µ–∑ 2-5 —Å–µ–∫—É–Ω–¥ –¥–æ–ª–∂–µ–Ω —Å–∫–∞—á–∞—Ç—å—Å—è PDF
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ "‚úÖ PDF –¥–æ–∫—É–º–µ–Ω—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!"

#### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å PDF
1. –û—Ç–∫—Ä—ã—Ç—å —Å–∫–∞—á–∞–Ω–Ω—ã–π —Ñ–∞–π–ª
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö —Ä–∞–∑–¥–µ–ª–æ–≤:
   - –ó–∞–≥–æ–ª–æ–≤–æ–∫ + –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
   - –ò—Ç–æ–≥–æ–≤–æ–µ –∑–∞–∫–ª—é—á–µ–Ω–∏–µ
   - –ê–Ω–∞–ª–∏–∑ –í–ù–î
   - –ê–Ω–∞–ª–∏–∑ –ù–ü–ê
   - –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å QR-–∫–æ–¥–æ–º
3. –û—Ç—Å–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å QR-–∫–æ–¥ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–º
4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è —Ç–æ—Ç –∂–µ PDF

### 2. API —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

#### –¢–µ—Å—Ç 1: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF
```bash
curl -X POST http://localhost:3000/api/export-pdf \
  -H "Content-Type: application/json" \
  -d '{
    "vnd": "–¢–µ—Å—Ç –í–ù–î",
    "np": "–¢–µ—Å—Ç –ù–ü–ê",
    "summary": "–¢–µ—Å—Ç –∑–∞–∫–ª—é—á–µ–Ω–∏—è",
    "fileName": "test",
    "language": "ru"
  }'
```

**–û–∂–∏–¥–∞–µ—Ç—Å—è:**
```json
{
  "success": true,
  "pdfId": "abc123...",
  "downloadUrl": "http://localhost:3000/api/download-pdf/abc123...",
  "qrCodeUrl": "data:image/png;base64,...",
  "size": 12345
}
```

#### –¢–µ—Å—Ç 2: –°–∫–∞—á–∏–≤–∞–Ω–∏–µ PDF
```bash
curl -o test.pdf http://localhost:3000/api/download-pdf/abc123...
open test.pdf
```

---

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF (1 —Å—Ç—Ä–∞–Ω–∏—Ü–∞) | ~50ms |
| –ì–µ–Ω–µ—Ä–∞—Ü–∏—è PDF (5 —Å—Ç—Ä–∞–Ω–∏—Ü) | ~200ms |
| –ì–µ–Ω–µ—Ä–∞—Ü–∏—è QR-–∫–æ–¥–∞ | ~10ms |
| –†–∞–∑–º–µ—Ä PDF (—Å—Ä–µ–¥–Ω–∏–π) | 50-150 KB |
| –í—Ä–µ–º—è –ø–æ–ª–Ω–æ–≥–æ —Ü–∏–∫–ª–∞ | 0.5-1 —Å–µ–∫ |

---

## üêõ Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: "–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ PDF –¥–æ–∫—É–º–µ–Ω—Ç–∞"

**–ü—Ä–∏—á–∏–Ω—ã:**
1. –ù–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∞–Ω–∞–ª–∏–∑–∞ (`analysisResult === null`)
2. –°–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç
3. –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø–∞–º—è—Ç–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ PDF

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∞–Ω–∞–ª–∏–∑ –∑–∞–≤–µ—Ä—à—ë–Ω (`analysisStep === 'complete'`)
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –æ—à–∏–±–∫–∏
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞: `[Export PDF] ‚ùå Error:`

### –ü—Ä–æ–±–ª–µ–º–∞: QR-–∫–æ–¥ –Ω–µ —Å–∫–∞–Ω–∏—Ä—É–µ—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω—ã:**
1. –ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –ø–µ—á–∞—Ç–∏
2. QR-–∫–æ–¥ –ø–æ–≤—Ä–µ–∂–¥—ë–Ω
3. URL —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–≤–µ–ª–∏—á–∏—Ç—å —Ä–∞–∑–º–µ—Ä QR-–∫–æ–¥–∞:
   ```typescript
   const qrCodeDataUrl = await QRCode.toDataURL(downloadUrl, {
     width: 300,  // –ë—ã–ª–æ: 200
   })
   ```
2. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å URL shortener –¥–ª—è `downloadUrl`

### –ü—Ä–æ–±–ª–µ–º–∞: PDF –Ω–µ —Å–∫–∞—á–∏–≤–∞–µ—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω—ã:**
1. –ë—Ä–∞—É–∑–µ—Ä –±–ª–æ–∫–∏—Ä—É–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ
2. PDF –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ storage (`404`)

**–†–µ—à–µ–Ω–∏–µ:**
1. –†–∞–∑—Ä–µ—à–∏—Ç—å pop-ups –¥–ª—è localhost
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ `pdfStorage.has(pdfId) === true`
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ä–æ–∫ –∂–∏–∑–Ω–∏ PDF (–ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ –æ—á–∏—â–∞–µ—Ç –ø–∞–º—è—Ç—å)

---

## üöÄ –ë—É–¥—É—â–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

### 1. –ü–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ
```typescript
// –ó–∞–º–µ–Ω–∞ Map –Ω–∞ Redis
import { createClient } from 'redis'
const redis = createClient()
await redis.set(`pdf:${pdfId}`, pdfBuffer, { EX: 3600 }) // TTL 1 —á–∞—Å
```

### 2. –£–ª—É—á—à–µ–Ω–Ω—ã–π –¥–∏–∑–∞–π–Ω PDF
- –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–æ—Ç–∏–ø –∫–æ–º–ø–∞–Ω–∏–∏
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–µ —à—Ä–∏—Ñ—Ç—ã
- –î–æ–±–∞–≤–∏—Ç—å —Ü–≤–µ—Ç–æ–≤—É—é —Å—Ö–µ–º—É

### 3. Email –æ—Ç–ø—Ä–∞–≤–∫–∞
```typescript
// –û—Ç–ø—Ä–∞–≤–∫–∞ PDF –Ω–∞ email
import nodemailer from 'nodemailer'
await transporter.sendMail({
  to: user.email,
  subject: '–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞',
  attachments: [{
    filename: 'analysis.pdf',
    content: pdfBuffer
  }]
})
```

### 4. –í–æ–¥—è–Ω—ã–µ –∑–Ω–∞–∫–∏
```typescript
// –î–æ–±–∞–≤–∏—Ç—å watermark
doc.setTextColor(200, 200, 200)
doc.setFontSize(60)
doc.text('DRAFT', pageWidth / 2, pageHeight / 2, {
  angle: 45,
  align: 'center'
})
```

---

## ‚úÖ Checklist

- [x] –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (jsPDF, qrcode)
- [x] –°–æ–∑–¥–∞–Ω `/api/export-pdf` endpoint
- [x] –°–æ–∑–¥–∞–Ω `/api/download-pdf/[id]` endpoint
- [x] –î–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "–í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å" –≤ UI
- [x] –î–æ–±–∞–≤–ª–µ–Ω–∞ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è (ru/kk/en)
- [x] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ PDF
- [x] QR-–∫–æ–¥ –≤—Å—Ç—Ä–æ–µ–Ω –≤ PDF
- [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö —è–∑—ã–∫–æ–≤
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö
- [ ] –ü–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω–∞

---

**–î–∞—Ç–∞:** 7 –æ–∫—Ç—è–±—Ä—è 2025 –≥.  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ  
**–í–µ—Ä—Å–∏—è:** 1.0.0
