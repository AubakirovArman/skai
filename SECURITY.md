# üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

## ‚ö†Ô∏è –í–ê–ñ–ù–û: –ó–∞—â–∏—Ç–∞ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### –§–∞–π–ª—ã —Å —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π

**–ù–ï –∫–æ–º–º–∏—Ç–∏—Ç—å –≤ Git:**
- ‚úÖ `.env.local` - —Å–æ–¥–µ—Ä–∂–∏—Ç —Ä–µ–∞–ª—å–Ω—ã–µ –ø–∞—Ä–æ–ª–∏ –∏ –∫–ª—é—á–∏
- ‚úÖ `.env.docker` - —Å–æ–¥–µ—Ä–∂–∏—Ç Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é (–µ—Å–ª–∏ –µ—Å—Ç—å)

**–ú–æ–∂–Ω–æ –∫–æ–º–º–∏—Ç–∏—Ç—å:**
- ‚úÖ `.env.example` - —à–∞–±–ª–æ–Ω –±–µ–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
- ‚úÖ `.env` - –ø—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

### –ß—Ç–æ –±—ã–ª–æ –∏–∑–º–µ–Ω–µ–Ω–æ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

#### 1. –í—Å–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –≤ `.env.local`

**–î–æ (—Ö–∞—Ä–¥–∫–æ–¥ –≤ –∫–æ–¥–µ):**
```typescript
// ‚ùå –ü–ª–æ—Ö–æ - –ø–∞—Ä–æ–ª–∏ –≤ –∫–æ–¥–µ
const VND_CONFIG = {
  host: '<YOUR_DB_HOST>',
  password: '<YOUR_DB_PASSWORD>',
}
```

**–ü–æ—Å–ª–µ (–∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è):**
```typescript
// ‚úÖ –•–æ—Ä–æ—à–æ - –∏–∑ env
const VND_CONFIG = {
  host: process.env.VND_DB_HOST,
  password: process.env.VND_DB_PASSWORD,
}
```

#### 2. –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- [x] `src/lib/alemllm.ts` - AlemLLM API URL –∏ –º–æ–¥–µ–ª—å –∏–∑ env
- [x] `src/lib/vector-db.ts` - –ü–∞—Ä–∞–º–µ—Ç—Ä—ã PostgreSQL –∏–∑ env
- [x] `src/lib/embedding-client.ts` - URL —Å–µ—Ä–≤–∏—Å–∞ —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –∏–∑ env
- [x] `.env.local` - –†–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è (–Ω–µ –≤ Git)
- [x] `.env.example` - –®–∞–±–ª–æ–Ω –¥–ª—è –Ω–æ–≤—ã—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- [x] `.gitignore` - –ó–∞—â–∏—Ç–∞ `.env.local` –æ—Ç –∫–æ–º–º–∏—Ç–∞

#### 3. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–í—Å–µ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Ç–µ–ø–µ—Ä—å –≤ `.env.local`:

```bash
# AlemLLM API
ALEMLLM_API_URL="<YOUR_ALEMLLM_API_URL>"
ALEMLLM_MODEL="astanahub/alemllm"

# PostgreSQL VND Database
VND_DB_HOST="<YOUR_DB_HOST>"
VND_DB_PORT="5433"
VND_DB_NAME="vnd"
VND_DB_USER="<your-username>"
VND_DB_PASSWORD="your-secure-password"

# PostgreSQL NPA Database
NPA_DB_HOST="<YOUR_DB_HOST>"
NPA_DB_PORT="5433"
NPA_DB_NAME="npa"
NPA_DB_USER="<your-username>"
NPA_DB_PASSWORD="your-secure-password"

# Embedding Service
EMBEDDING_SERVICE_URL="http://localhost:8001"

# NextAuth
NEXTAUTH_SECRET="your-random-32-char-secret"
NEXTAUTH_URL="http://localhost:3000"
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –¥–ª—è –Ω–æ–≤—ã—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
```bash
git clone <repo-url>
cd skai
```

### 2. –°–æ–∑–¥–∞—Ç—å `.env.local` –∏–∑ —à–∞–±–ª–æ–Ω–∞
```bash
cp .env.example .env.local
```

### 3. –ó–∞–ø–æ–ª–Ω–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
```bash
nano .env.local
# –ü–æ–ª—É—á–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –ø–∞—Ä–æ–ª–∏ –æ—Ç –∫–æ–º–∞–Ω–¥—ã
```

### 4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
```bash
node test-env-config.mjs
```

### 5. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å
```bash
npm install
npm run dev
```

## üîí –ü—Ä–∞–≤–∏–ª–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

1. **–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∫–æ–º–º–∏—Ç—å—Ç–µ `.env.local`**
   ```bash
   # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º
   git status
   # .env.local –ù–ï –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Å–ø–∏—Å–∫–µ
   ```

2. **–ù–µ –¥–µ–ª–∏—Ç–µ—Å—å –ø–∞—Ä–æ–ª—è–º–∏ –≤ —á–∞—Ç–∞—Ö**
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∫–∞–Ω–∞–ª—ã (1Password, LastPass, Bitwarden)
   - –ò–ª–∏ –ø–µ—Ä–µ–¥–∞–≤–∞–π—Ç–µ –ª–∏—á–Ω–æ

3. **–†–µ–≥—É–ª—è—Ä–Ω–æ –º–µ–Ω—è–π—Ç–µ –ø–∞—Ä–æ–ª–∏**
   - –û—Å–æ–±–µ–Ω–Ω–æ –ø–æ—Å–ª–µ —É—Ö–æ–¥–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
   - –ü–æ—Å–ª–µ –ø–æ–¥–æ–∑—Ä–µ–Ω–∏—è –Ω–∞ —É—Ç–µ—á–∫—É

4. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–∏–ª—å–Ω—ã–µ –ø–∞—Ä–æ–ª–∏**
   ```bash
   # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ –ø–∞—Ä–æ–ª—è
   openssl rand -base64 32
   ```

### –î–ª—è DevOps

1. **–ù–∞ production —Å–µ—Ä–≤–µ—Ä–µ**
   ```bash
   # –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
   chmod 600 .env.local
   chown app-user:app-user .env.local
   
   # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Ñ–∞–π–ª –Ω–µ —á–∏—Ç–∞–µ—Ç—Å—è –¥—Ä—É–≥–∏–º–∏
   ls -la .env.local
   # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: -rw------- 1 app-user app-user
   ```

2. **–†–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ**
   ```bash
   # Backup –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (–∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π)
   gpg -c .env.local
   # –°–æ—Ö—Ä–∞–Ω–∏—Ç—å .env.local.gpg –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –º–µ—Å—Ç–æ
   ```

3. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - –ù–µ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–æ–ª–∏
   - –ù–µ –≤—ã–≤–æ–¥–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ –ª–æ–≥–∏
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `***` –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è —Å–µ–∫—Ä–µ—Ç–æ–≤

### –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –ë–î

1. **–°–æ–∑–¥–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è**
   ```sql
   -- –í–º–µ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è postgres superuser
   CREATE USER skai_app WITH PASSWORD 'strong-password';
   GRANT CONNECT ON DATABASE vnd TO skai_app;
   GRANT CONNECT ON DATABASE npa TO skai_app;
   GRANT SELECT ON ALL TABLES IN SCHEMA public TO skai_app;
   ```

2. **–û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –ø–æ IP**
   ```conf
   # pg_hba.conf
   host  vnd  skai_app  10.0.0.0/8  scram-sha-256
   host  npa  skai_app  10.0.0.0/8  scram-sha-256
   ```

## üìù –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–π —á–µ–∫–ª–∏—Å—Ç

### –ü–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º –≤ Git

- [ ] `.env.local` –ù–ï –≤ —Å–ø–∏—Å–∫–µ `git status`
- [ ] `.env.example` —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ –ø—Ä–∏–º–µ—Ä—ã, –±–µ–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- [ ] –ü–∞—Ä–æ–ª–∏ –Ω–µ hardcoded –≤ –∫–æ–¥–µ
- [ ] API –∫–ª—é—á–∏ –±–µ—Ä—É—Ç—Å—è –∏–∑ `process.env`
- [ ] –õ–æ–≥–∏ –Ω–µ —Å–æ–¥–µ—Ä–∂–∞—Ç —Å–µ–∫—Ä–µ—Ç–æ–≤

### –ü–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º

- [ ] `.env.local` —Å–æ–∑–¥–∞–Ω –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- [ ] –í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã
- [ ] `node test-env-config.mjs` –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç 15/15 ‚úÖ
- [ ] –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ `chmod 600 .env.local`
- [ ] `NODE_ENV="production"` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- [ ] `NEXTAUTH_URL` —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ production –¥–æ–º–µ–Ω
- [ ] –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –¥–æ—Å—Ç—É–ø–Ω—ã (PostgreSQL, Embedding service, AlemLLM)

### –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

- [ ] –ê—É–¥–∏—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –±–∞–∑–∞–º –¥–∞–Ω–Ω—ã—Ö
- [ ] –†–æ—Ç–∞—Ü–∏—è –ø–∞—Ä–æ–ª–µ–π (–∫–∞–∂–¥—ã–µ 90 –¥–Ω–µ–π)
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –Ω–∞ —É—Ç–µ—á–∫–∏
- [ ] –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (`npm audit`)
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤

## üÜò –ß—Ç–æ –¥–µ–ª–∞—Ç—å –ø—Ä–∏ —É—Ç–µ—á–∫–µ

### –ï—Å–ª–∏ –ø–∞—Ä–æ–ª—å/–∫–ª—é—á –ø–æ–ø–∞–ª –≤ Git

1. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ —Å–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å/–∫–ª—é—á**
2. **–£–¥–∞–ª–∏—Ç—å –∏–∑ Git –∏—Å—Ç–æ—Ä–∏–∏**
   ```bash
   # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å git-filter-repo –∏–ª–∏ BFG
   git filter-repo --path .env.local --invert-paths
   git push --force
   ```
3. **–£–≤–µ–¥–æ–º–∏—Ç—å –∫–æ–º–∞–Ω–¥—É**
4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –ë–î**

### –ï—Å–ª–∏ –ø–æ–¥–æ–∑—Ä–µ–Ω–∏–µ –Ω–∞ –∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏—é

1. **–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø**
2. **–°–º–µ–Ω–∏—Ç—å –≤—Å–µ –ø–∞—Ä–æ–ª–∏**
3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –∞–Ω–æ–º–∞–ª–∏–∏**
4. **–ü—Ä–æ–≤–µ—Å—Ç–∏ –∞—É–¥–∏—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- [ENV_CONFIGURATION.md](./ENV_CONFIGURATION.md) - –ü–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
- [DEPLOYMENT_GUIDE.md](./DEPLOYMENT_GUIDE.md) - –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é
- [Next.js Environment Variables](https://nextjs.org/docs/app/building-your-application/configuring/environment-variables)

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 5 –æ–∫—Ç—è–±—Ä—è 2025
**–í–µ—Ä—Å–∏—è:** 1.0.0
